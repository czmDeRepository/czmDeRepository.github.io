<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>docker学习笔记 | 菜鸟明De博客</title><meta name="description" content="常用命令查看容器的挂载目录123docker inspect 容器名 | grep Mounts -A 20# -A 20（显示Mounts往下20行）# docker inspect 获取容器&#x2F;镜像的元数据  查看所有容器1docker ps -a  查看所有镜像1docker images  进入容器12docker exec -it  容器名或id &#x2F;bin&#x2F;bash# 退出 CTRL+Q+"><meta name="keywords" content="部署"><meta name="author" content="CZM,2723081630@qq.com"><meta name="copyright" content="CZM"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://czmderepository.gitee.io/2021/02/07/%E9%83%A8%E7%BD%B2/docker/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="docker学习笔记"><meta property="og:url" content="https://czmderepository.gitee.io/2021/02/07/%E9%83%A8%E7%BD%B2/docker/"><meta property="og:site_name" content="菜鸟明De博客"><meta property="og:description" content="常用命令查看容器的挂载目录123docker inspect 容器名 | grep Mounts -A 20# -A 20（显示Mounts往下20行）# docker inspect 获取容器&#x2F;镜像的元数据  查看所有容器1docker ps -a  查看所有镜像1docker images  进入容器12docker exec -it  容器名或id &#x2F;bin&#x2F;bash# 退出 CTRL+Q+"><meta property="og:image" content="https://s1.ax1x.com/2020/09/17/wfu2n0.jpg"><meta property="article:published_time" content="2021-02-07T06:47:00.000Z"><meta property="article:modified_time" content="2021-11-23T13:37:16.258Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime: '',
  date_suffix: {"one_hour":"刚刚","hours":"小时前","day":"天前"},
  copyright: undefined,
  ClickShowText: {"text":"小帅哥,爱你,过浪险,欢迎您,过压贴,光临本园,加油,努力,酷炫低调奢华,拼搏,forever,爱你","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"按","message_next":"键将本页加入书签"},"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-11-23 21:37:16'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://s1.ax1x.com/2020/09/17/wRG4fS.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">53</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">23</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.</span> <span class="toc-text">常用命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E7%9A%84%E6%8C%82%E8%BD%BD%E7%9B%AE%E5%BD%95"><span class="toc-number">1.1.</span> <span class="toc-text">查看容器的挂载目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E5%AE%B9%E5%99%A8"><span class="toc-number">1.2.</span> <span class="toc-text">查看所有容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E6%89%80%E6%9C%89%E9%95%9C%E5%83%8F"><span class="toc-number">1.3.</span> <span class="toc-text">查看所有镜像</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8"><span class="toc-number">1.4.</span> <span class="toc-text">进入容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E5%91%BD%E5%90%8D%E5%AE%B9%E5%99%A8"><span class="toc-number">1.5.</span> <span class="toc-text">重命名容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E4%BF%A1%E6%81%AF"><span class="toc-number">1.6.</span> <span class="toc-text">查看容器信息</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8B%B7%E8%B4%9D%E5%AE%B9%E5%99%A8%E9%87%8C%E7%9A%84%E6%96%87%E4%BB%B6%E5%88%B0%E5%AE%BF%E4%B8%BB%E6%9C%BA"><span class="toc-number">1.7.</span> <span class="toc-text">拷贝容器里的文件到宿主机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%90%9C%E7%B4%A2"><span class="toc-number">1.8.</span> <span class="toc-text">镜像搜索</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8ip"><span class="toc-number">1.9.</span> <span class="toc-text">查看容器ip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E6%8B%89%E5%8F%96"><span class="toc-number">1.10.</span> <span class="toc-text">镜像拉取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.11.</span> <span class="toc-text">镜像上传</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-number">1.12.</span> <span class="toc-text">搭建私有仓库</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93%E6%90%AD%E5%BB%BA%E4%B8%8E%E9%85%8D%E7%BD%AE"><span class="toc-number">1.12.1.</span> <span class="toc-text">私有仓库搭建与配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%95%9C%E5%83%8F%E4%B8%8A%E4%BC%A0%E8%87%B3%E7%A7%81%E6%9C%89%E4%BB%93%E5%BA%93"><span class="toc-number">1.12.2.</span> <span class="toc-text">镜像上传至私有仓库</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">示例</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%B9%B6%E8%BF%90%E8%A1%8CMySQL%E5%AE%B9%E5%99%A8"><span class="toc-number">2.1.</span> <span class="toc-text">创建并运行MySQL容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAzookeeper%E5%AE%B9%E5%99%A8"><span class="toc-number">2.2.</span> <span class="toc-text">创建zookeeper容器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAkafka%E5%AE%B9%E5%99%A8"><span class="toc-number">2.3.</span> <span class="toc-text">创建kafka容器</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BB%84%E4%BB%B6%E5%B7%A5%E5%85%B7"><span class="toc-number">3.</span> <span class="toc-text">组件工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#DockerfFile"><span class="toc-number">4.</span> <span class="toc-text">DockerfFile</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Dockerfile%E7%A4%BA%E4%BE%8B"><span class="toc-number">4.0.1.</span> <span class="toc-text">Dockerfile示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AUFS"><span class="toc-number">4.1.</span> <span class="toc-text">AUFS</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B7%B1%E5%85%A5"><span class="toc-number">5.</span> <span class="toc-text">深入</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#LXC"><span class="toc-number">5.1.</span> <span class="toc-text">LXC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#CGroups%EF%BC%88Controller-Groups%EF%BC%89"><span class="toc-number">5.1.1.</span> <span class="toc-text">CGroups（Controller Groups）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Namespaces"><span class="toc-number">5.1.2.</span> <span class="toc-text">Namespaces</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84"><span class="toc-number">5.2.</span> <span class="toc-text">体系结构</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Docker-Daemon%E4%B8%BB%E8%A6%81%E4%BB%BB%E5%8A%A1"><span class="toc-number">5.3.</span> <span class="toc-text">Docker Daemon主要任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">5.4.</span> <span class="toc-text">参考</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#END"><span class="toc-number">6.</span> <span class="toc-text">END</span></a></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2020/09/17/wfu2n0.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">菜鸟明De博客</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">docker学习笔记</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-02-07T06:47:00.000Z" title="发表于 2021-02-07 14:47:00">2021-02-07</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2021-11-23T13:37:16.258Z" title="更新于 2021-11-23 21:37:16">2021-11-23</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><h2 id="查看容器的挂载目录"><a href="#查看容器的挂载目录" class="headerlink" title="查看容器的挂载目录"></a>查看容器的挂载目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器名 | grep Mounts -A 20</span><br><span class="line"><span class="comment"># -A 20（显示Mounts往下20行）</span></span><br><span class="line"><span class="comment"># docker inspect 获取容器/镜像的元数据</span></span><br></pre></td></tr></table></figure>

<h2 id="查看所有容器"><a href="#查看所有容器" class="headerlink" title="查看所有容器"></a>查看所有容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<h2 id="查看所有镜像"><a href="#查看所有镜像" class="headerlink" title="查看所有镜像"></a>查看所有镜像</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images</span><br></pre></td></tr></table></figure>

<h2 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it  容器名或id /bin/bash</span><br><span class="line"><span class="comment"># 退出 CTRL+Q+P 或直接输入exit</span></span><br></pre></td></tr></table></figure>

<h2 id="重命名容器"><a href="#重命名容器" class="headerlink" title="重命名容器"></a>重命名容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rename 原容器名  新容器名</span><br></pre></td></tr></table></figure>

<h2 id="查看容器信息"><a href="#查看容器信息" class="headerlink" title="查看容器信息"></a>查看容器信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker inspect 容器名（返回回key/value json格式数据）</span><br><span class="line">docker inspect -f &#123;&#123;类似EL表达式&#125;&#125; 容器名 <span class="comment">#返回具体参数</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20210514202601652.png" alt="image-20210514202601652"></p>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20210514203047822.png" alt="image-20210514203047822"></p>
<h2 id="拷贝容器里的文件到宿主机"><a href="#拷贝容器里的文件到宿主机" class="headerlink" title="拷贝容器里的文件到宿主机"></a>拷贝容器里的文件到宿主机</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp 容器名：容器里文件路径 宿主机路径</span><br></pre></td></tr></table></figure>

<h2 id="镜像搜索"><a href="#镜像搜索" class="headerlink" title="镜像搜索"></a>镜像搜索</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">docker search [OPTIONS] TERM</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -f, --filter filter   Filter output based on conditions provided</span><br><span class="line">      --format string   Pretty-print search using a Go template</span><br><span class="line">      --<span class="built_in">limit</span> int       Max number of search results (default 25)</span><br><span class="line">      --no-trunc        Don<span class="string">&#x27;t truncate output：# 描述信息栏不会被截断，会显示完整的描述信息。</span></span><br><span class="line"><span class="string">如：</span></span><br><span class="line"><span class="string"># 只搜索官方镜像</span></span><br><span class="line"><span class="string">docker search --filter &quot;is-official=true&quot; mysql</span></span><br><span class="line"><span class="string">docker search -f &quot;is-official=true&quot; mysql</span></span><br><span class="line"><span class="string"># 只搜索starts不小于100的2个镜像</span></span><br><span class="line"><span class="string">docker search -f stars=100 --limit 2 mysql</span></span><br><span class="line"><span class="string">docker search --filter stars=100  --limit 2 mysql</span></span><br><span class="line"><span class="string"># 只搜索自动化构建镜像</span></span><br><span class="line"><span class="string">docker search -f &quot;is-automated=true&quot; mysql</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># 格式化输出</span></span><br><span class="line"><span class="string"># Placeholder	Description</span></span><br><span class="line"><span class="string">#.Name			镜像名称</span></span><br><span class="line"><span class="string">#.Description	镜像描述</span></span><br><span class="line"><span class="string">#.StarCount	stars 数量</span></span><br><span class="line"><span class="string">#.IsOfficial	如果是官方镜像，显示 “OK”</span></span><br><span class="line"><span class="string">#.IsAutomated	如果是自动化构建，显示“OK”</span></span><br><span class="line"><span class="string">docker search --format &quot;&#123;&#123;.Name&#125;&#125;: &#123;&#123;.StarCount&#125;&#125;&quot; mysql --limit  3</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211122145913167.png" alt="image-20211122145913167"></p>
<ul>
<li>STARS：星级（星级越高，代表镜像质量越高）</li>
<li>OFFICIAL：是否官方</li>
<li>AUTOMATED：是否为docker自动化构建</li>
</ul>
<h2 id="查看容器ip"><a href="#查看容器ip" class="headerlink" title="查看容器ip"></a>查看容器ip</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format=<span class="string">&#x27;&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;&#x27;</span> 容器id</span><br></pre></td></tr></table></figure>

<h2 id="镜像拉取"><a href="#镜像拉取" class="headerlink" title="镜像拉取"></a>镜像拉取</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br><span class="line">Pull an image or a repository from a registry</span><br><span class="line">Options:</span><br><span class="line">  -a, --all-tags                Download all tagged images <span class="keyword">in</span> the repository</span><br><span class="line">      --disable-content-trust   Skip image verification (default <span class="literal">true</span>)</span><br><span class="line">      --platform string         Set platform <span class="keyword">if</span> server is multi-platform capable</span><br><span class="line">  -q, --quiet                   Suppress verbose output</span><br></pre></td></tr></table></figure>

<h2 id="镜像上传"><a href="#镜像上传" class="headerlink" title="镜像上传"></a>镜像上传</h2><p>注：执行push前需要执行login进行用户身份认证</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker push [OPTIONS] NAME[:TAG]</span><br><span class="line">Push an image or a repository to a registry</span><br><span class="line">Options:</span><br><span class="line">  -a, --all-tags                Push all tagged images <span class="keyword">in</span> the repository</span><br><span class="line">      --disable-content-trust   Skip image signing (default <span class="literal">true</span>)</span><br><span class="line">  -q, --quiet                   Suppress verbose output <span class="comment"># 抑制详细输出</span></span><br></pre></td></tr></table></figure>



<h2 id="搭建私有仓库"><a href="#搭建私有仓库" class="headerlink" title="搭建私有仓库"></a>搭建私有仓库</h2><h3 id="私有仓库搭建与配置"><a href="#私有仓库搭建与配置" class="headerlink" title="私有仓库搭建与配置"></a>私有仓库搭建与配置</h3><ol>
<li>拉取私有仓库镜像。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull registry</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>启动私有仓库容器。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -di --name=registry -p 5000:5000 registry</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>打开浏览器 输入地址<code>ip:5000/v2/_catalog</code>看到<code>&#123;&quot;repositories&quot;:[]&#125;</code> 表示私有仓库搭建成功并且内容为空。</li>
<li>修改daemon.json。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/docker/daemon.json</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>添加私有仓库地址，让 docker信任私有仓库地址，保存退出。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;insecure-registries&quot;</span>:[<span class="string">&quot;ip:5000&quot;</span>]&#125; </span><br></pre></td></tr></table></figure>

<ol start="5">
<li>重启docker 服务。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<h3 id="镜像上传至私有仓库"><a href="#镜像上传至私有仓库" class="headerlink" title="镜像上传至私有仓库"></a>镜像上传至私有仓库</h3><ol>
<li>标记镜像为私有仓库的镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker tag 镜像 ip:5000/镜像tag</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>再次启动私服容器</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker start registry</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>上传标记的镜像</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker push ip:5000/镜像tag</span><br></pre></td></tr></table></figure>



<h1 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h1><h2 id="创建并运行MySQL容器"><a href="#创建并运行MySQL容器" class="headerlink" title="创建并运行MySQL容器"></a>创建并运行MySQL容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run </span><br><span class="line">-p 3307:3306 <span class="comment">#端口映射</span></span><br><span class="line">--name mysql-master1 <span class="comment"># 容器名</span></span><br><span class="line"><span class="comment">#挂载路径</span></span><br><span class="line">-v /usr/<span class="built_in">local</span>/mysql_cluster/master1/conf/my.cnf:/etc/mysql/my.cnf <span class="comment">#配置文件</span></span><br><span class="line">-v /usr/<span class="built_in">local</span>/mysql_cluster/master1/data/:/var/lib/mysql  <span class="comment">#数据库数据</span></span><br><span class="line">-e MYSQL_ROOT_PASSWORD= root用户密码</span><br><span class="line">-d <span class="comment">#后台运行</span></span><br><span class="line">mysql <span class="comment">#镜像名</span></span><br></pre></td></tr></table></figure>

<h2 id="创建zookeeper容器"><a href="#创建zookeeper容器" class="headerlink" title="创建zookeeper容器"></a>创建zookeeper容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --name zookeeper --restart always -d -v /usr/<span class="built_in">local</span>/docker_container_config/zookeeper/conf/:/conf/ -p 2181:2181 zookeeper</span><br><span class="line"></span><br><span class="line"><span class="comment">#--restart always指docker重启时该容器也重启</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#docker container update --restart=always 容器名字</span></span><br></pre></td></tr></table></figure>

<h2 id="创建kafka容器"><a href="#创建kafka容器" class="headerlink" title="创建kafka容器"></a>创建kafka容器</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d --name kafka -p 9092:9092 -e KAFKA_BROKER_ID=0 -e KAFKA_ZOOKEEPER_CONNECT=192.168.38.128:2181/kafka -e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.38.128:9092 -e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 -v /etc/localtime:/etc/localtime -v /usr/<span class="built_in">local</span>/docker_container_config/kafka/config/server.properties:/opt/kafka/config/server.properties wurstmeister/kafka</span><br><span class="line"></span><br><span class="line"><span class="comment">#-e KAFKA_BROKER_ID=0  在kafka集群中，每个kafka都有一个BROKER_ID来区分自己</span></span><br><span class="line"><span class="comment">#-e KAFKA_ZOOKEEPER_CONNECT=192.168.155.56:2181/kafka 配置zookeeper管理kafka的路径192.168.38.128:2181/kafka</span></span><br><span class="line"><span class="comment">#-e KAFKA_ADVERTISED_LISTENERS=PLAINTEXT://192.168.38.128:9092  把kafka的地址端口注册给zookeeper</span></span><br><span class="line"><span class="comment">#-e KAFKA_LISTENERS=PLAINTEXT://0.0.0.0:9092 配置kafka的监听端口</span></span><br><span class="line"><span class="comment">#-v /etc/localtime:/etc/localtime 容器时间同步虚拟机的时间</span></span><br></pre></td></tr></table></figure>

<h1 id="组件工具"><a href="#组件工具" class="headerlink" title="组件工具"></a>组件工具</h1><ul>
<li><strong>docker-Machine</strong></li>
</ul>
<blockquote>
<p>负责实现对 Docker 运行环境进行安装和管理，特别在管理多个 Docker 环境时，使用 Machine 要比手动管理高效得多。</p>
</blockquote>
<ul>
<li><strong>docker-swarm</strong></li>
</ul>
<blockquote>
<p>提供 Docker 容器集群服务，是docker官方对容器云生态进行支持的核心方案。使用它，用户可以将多个 Docker 主机抽象为大规模的虚拟 Docker 服务，快速打造一套容器云平台。</p>
</blockquote>
<ul>
<li><strong>docker-compose</strong></li>
</ul>
<blockquote>
<p>主要用于docker容器在集群中快速部署。负责实现对基于 Docker器的多应用服务的快速编排，利用docker-compose，从用户可以自定义哪个容器运行在哪个应用。与此同时，docker-compose也支持热部署，而且可以根据负载情况随时扩展。</p>
</blockquote>
<h1 id="DockerfFile"><a href="#DockerfFile" class="headerlink" title="DockerfFile"></a>DockerfFile</h1><p>​    Dockerfile是一个文本文件，存储Docker可以读懂的脚本指令，在这个脚本文件中记录着用户“创建”镜像过程当中需要执行的所有命令。当Docker 读取并执行Dockerfile 中所定义的命令时，这些命令将会产生一些临时文件层（<strong>AUFS</strong>所使用的文件层）。当Dockerfile所有命令都成功执行完之后，Docker 会记录执行过程中所用到的所有文件层，并且会用一个名称来标记这一组文件层。这一组文件层，就被称之为<strong>镜像</strong>（镜像指的是一组特定的文件层）。Docker中镜像的构建过程，就是 Docker 执行Dockerfile中所定义命令而形成这组文件层的过程。Docker中所有的容器都是基于镜像而创建的，而所有的镜像又都是通过Dockerfile而形成的。</p>
<blockquote>
<p>内置命令</p>
</blockquote>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211122165728898.png" alt="image-20211122165728898"></p>
<h3 id="Dockerfile示例"><a href="#Dockerfile示例" class="headerlink" title="Dockerfile示例"></a>Dockerfile示例</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FROM buildpack-deps:wheezy-scm</span><br><span class="line"><span class="comment"># gcc for cgo</span></span><br><span class="line">RUN apt-get update &amp;&amp; apt-get instal1 -y</span><br><span class="line">gcc libc6-dev make l</span><br><span class="line">--no-instal1-recommends N&amp;&amp; rm -rf /var/lib/apt/lists/*</span><br><span class="line"></span><br><span class="line">ENV GOLANGVERSION 1.5</span><br><span class="line">ENV GOLANG_DOWNLOAD_URL https://golang.org/dl/go<span class="variable">$GOLANG_VERSION</span>.1inux-amd64.tar.gz</span><br><span class="line">ENV GOLANG _DOWNLOAD_SHA1 5817fa4b2252afdbe2e11e8b9dc1d9173ef3bd5a</span><br><span class="line">RUN cur1 -fsSL“<span class="variable">$GOLANG_DOWNLOAD_URL</span><span class="string">&quot; -o golang.tar.gz </span></span><br><span class="line"><span class="string"> &amp;&amp; echo &quot;</span><span class="variable">$GOLANG_DOWNLOAD_SHA1</span> golang.tar.gz<span class="string">&quot; | sha1sum -c - </span></span><br><span class="line"><span class="string"> &amp;&amp; tar-C /usr/local -xzf golang.tar.gzN &amp;&amp; rm golang.tar.gz</span></span><br><span class="line"><span class="string">ENV GOPATH /go</span></span><br><span class="line"><span class="string">ENV PATH <span class="variable">$GOPATH</span>/bin :/usr/local/go/bin:<span class="variable">$PATH</span></span></span><br><span class="line"><span class="string">RUN mkdir -p&quot;</span><span class="variable">$GOPATH</span>/src<span class="string">&quot; &quot;</span><span class="variable">$GOPATH</span>/bin<span class="string">&quot; &amp;&amp; chmod -R 777 &quot;</span> <span class="variable">$GOPATH</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">WORKDIR <span class="variable">$GOPATH</span></span></span><br><span class="line"><span class="string">COPY go-wrapper /usr/local/bin/</span></span><br></pre></td></tr></table></figure>

<h2 id="AUFS"><a href="#AUFS" class="headerlink" title="AUFS"></a>AUFS</h2><p>AUFS（Advanced Multi Layered Unification Filesystem 高级多层次统一文件系统）是一个堆栈式联合文件系统。它可以将不同地方的目录挂载到同一个虚拟文件系统之中，并且形成“文件层”。在将不同目录挂载到同一文件系统下时，还可以给不同目录设定<strong>只读、只写和写出</strong>三种权限。AUFS在挂载目录时，会严格按照先基础目录(父文件层）再增量目录(子文件层）的顺序进行挂载。（docker通过AUFS实现镜像文件层、数据共享）所有目录都挂载完之后，AUFS 会再挂载一个可读可写的目录，而以后所有的写操作都会体现在此目录中（docker容器的修改操作都在这一层）。</p>
<h1 id="深入"><a href="#深入" class="headerlink" title="深入"></a>深入</h1><h2 id="LXC"><a href="#LXC" class="headerlink" title="LXC"></a>LXC</h2><p>​    <strong>LXC</strong>(Linux container)是整个Docker运行的基础。众所周知，CPU、内存、IO、网络等都称之为系统资源，而Linux内核有一套机制来管理其所拥有的这些资源，这套机制的核心被称之为CGroups和Namespaces。</p>
<h3 id="CGroups（Controller-Groups）"><a href="#CGroups（Controller-Groups）" class="headerlink" title="CGroups（Controller Groups）"></a><strong>CGroups</strong>（Controller Groups）</h3><p>为资源管理提供了一个统一框架，可以把系统任务及其子任务整合（或分隔）到按资源等级而划分的不同任务组内，并且对这些任务组实施不同的资源分配方案。可以限制、记录、调整进程组所使用的物理资源（包括CPU、memory、I/O等)。如:使用CGroups可以给某项进程组多分配一些CPU使用周期。同样也可以通过CGroups限制某项进程组可使用的内存上限。同时CGroups 也具有记录物理资源使用情况的功能，比如 CGroups调用 <code>cpuacct</code>子系统就可以记录每个进程所使用的<strong>内存数量、CPU时间等数据</strong>。正因为Linux有了CGroups资源管理机制，内核虚拟化才变成了可能。</p>
<blockquote>
<ul>
<li>CGroups机制中有四个重要概念。<br> 任务（ task)。一个任务对应宿主机环境当中的一个进程。</li>
<li>子系统（subsystem)。每一个子系统是对某一项具体物理资源的控制器。例如，cpu子系统就是对CPU资源的控制，内存子系统就是对内存资源的控制。</li>
<li>控制组(control group)。cgroups当中最基本的控制单元。一个group包含若干个任务(对应宿主环境的进程)，并且此 group也会包含若干子系统，用来控制group 内的仕务仕指疋丁系统上面的资源使用。</li>
<li>层级树(hierarchy)。cgroups的调度单位，由一个或多个group组成的树状结构。每个hierarchy通过绑定对应的子系统进行资源调度，同时子节点继承父节点的属性。整个系统可以有多个hierarchy。</li>
</ul>
<p><strong>cgroups共有10个子系统</strong>:（执行<code>ls /sys/fs/cgroup/</code>命令查看）</p>
<ol>
<li>blkio:为块设备（比如磁盘，固态硬盘，USB等）设定IO限制。</li>
<li>cpu: 对CPU资源的控制。</li>
<li>cpuacct:为cgroup中任务生成CPU 资源使用报告。</li>
<li>cpuset:在多CPU系统中，为cgroup中的任务分配独立CPU和内存节点。</li>
<li>devices:设置任务对物理设备的访问权限。</li>
<li>freezer:挂起或者恢复cgroup 中的任务。</li>
<li>memory:设定cgroup中任务使用的内存限制，同时生成任务的内存资源使用报告。</li>
<li>net_cls:使用等级识别符（classid)标记网络数据包，同时使用Linux流量控制程序(tc)识别从具体cgroup 中生成的数据包。</li>
<li>net_prio:对应用程序设置网络传输优先级，类似于socket选项的SO_PRIORITY。</li>
<li>HugeTLB:HugeTLB页的资源控制功能。</li>
</ol>
</blockquote>
<h3 id="Namespaces"><a href="#Namespaces" class="headerlink" title="Namespaces"></a><strong>Namespaces</strong></h3><p>一个重要的资源隔离机制。Namespaces 将进程、进程组、IPC（Inter-Process Communication，进程间通信资源：管道、消息队列……）、网络、内存等资源都变得不再是全局性资源，而是将这些资源从内核层面属于某个特定的Namespace。在不同的Namespace之间，这些资源是相互透明、不可见的。比如说，A用户登录系统后，可以查看到B用户的进程PID。虽说A用户不能杀死B用户的进程，但A和B却能相互感知。但假如A用户在Namespace-A中，B用户在Namespace-B中，虽然A和B仍然共存于同一个Linux操作系统当中，但A却无法感知到B。在这种情况下，Linux内核不但将Namespace相互隔离，而且将所分配的资源牢牢固定在各自空间之中。</p>
<p><strong>IPC Namespace</strong></p>
<blockquote>
<p>Linux系统进程间通讯主要包括：信号量、消息队列和共享内存，对于一个资源隔离的容器来说，容器内的进程只能访问主机分配给它的资源，IPC Namespace允许容器内所有进程通过全局唯一的32位标识符访问共享资源。使容器内部的进程通信，对于宿主机来说，就是相同PID的进程通信。</p>
</blockquote>
<p><strong>PID Namespace</strong></p>
<blockquote>
<p>容器之间的进程树相互不可见。通过PID Namespace，为容器创建了独立的进程资源，每个容器中都会有一个进程号计数器，容器内所有的进程号都会重新编号。宿主机的内核会维护各个容器中的进程树，在树最顶端的进程亏变为l，也就定Init进柱。此进程会作为容器内其他所有进程的父进程来执行容器环境的初始化工作。但此Init进程毕竟不是实际操作系统中的 Init进程，在宿主机环境中，只是个普通进程。所以容器中的Init进程其实是一个伪 Init进程，它无法像真正的 Init 进程那样“守护”整个容器操作环境。当Init进程下面所有的子进程都退出后，它也就无可避免地需要退出。而这也就是每个容器启动时都需要指定一个<strong>不可退出的进程作为CMD的原因</strong>。同时Init进程作为容器中所有进程的父进程，还肩负着关闭和销毁容器的责任。因为借助于PID Namespace在容器中所产生的进程树，处于树顶点的 Init进程可以看到容器中所有的子进程，并且可以通过信号量来影响子进程的行为。所以 Docker CLI 中的Stop或者Kill 命令的本质，就是向容器中的Init进程发送SIGSTOP信号或者SIGKILL信号。一旦容器处于顶点的Init进程被销毁，那么和其处于同一个 PID Namespace的所有进程都将会接收到内核发送的SIGSTOP或者SIGKILL信号而被销毁。</p>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211123011325510.png" alt="image-20211123011325510"></p>
</blockquote>
<p><strong>UTS Namespace</strong></p>
<blockquote>
<p>PID Namespace使容器拥有独立进程树，仅仅只能在宿主环境层面可以被视为独立节点。UTS Namespace使容器在网络层面被设为一个独立节点。它为每个容器设置了容器主机名和容器域名，因为这两个属性在每个容器当中都是独立且唯一的，因此每个容器在网络中都可被设为单独节点，拥有了独立主机名和域名资源，而非宿主机环境中的单独进程。</p>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211123011245309.png" alt="image-20211123011245309"></p>
</blockquote>
<p><strong>Network Namespace</strong></p>
<blockquote>
<p><strong>为每个容器隔离网络资源</strong>。在 Linux系统中一个物理设备最多只能被包括在一个Network Namespace中，但我们所创建的容器却不止一个。Docker为每个容器的Network创建一对虚拟网络设备，一个名为eth0，放置到容器当中;另外一个名为vethN，放置到宿主机环境当中。这样从一个设备中流入数据，就可以从相对应的另外一个设备中读取到数据。虽然从宿主机内核层面来看，其<strong>实这两个网卡只是管道的两端</strong>;但从容器中来看，这就是两块实际的网卡。通过这种方式，可以达到容器和内核之间数据流通的目的。但为了达到<strong>不同容器可以作为网络单独节点进行数据交互</strong>的目标，Docker在Network Namespace中还为<strong>每个容器设置了IP路由表</strong>。宿主机环境此时就充当了路由器的角色，因此毫不相干的两个容器就可以通过其内部的”网卡”互通数据。</p>
</blockquote>
<p><strong>User Namespace</strong></p>
<blockquote>
<p>docker通过User Namespace隔离了所有与用户相关的资源，包括用户ID、用户组ID、用户权限。但无论容器中的用户怎么变，始终对应的是宿主机环境中所创建容器的用户，而且这种关联关系通过/proc/[pid]/uid_map和/proc/[pid]/gid_map这两个文件予以保存。</p>
</blockquote>
<p><strong>Mount Namespace</strong></p>
<blockquote>
<p>docker通过 Mount namespace为每个容器分配了独立的文件系统。因为在 Mount Namespace当中，可以通过隔离文件挂载点的方式提供隔离的文件系统，因此，Docker为每个容器创建一个其独有的目录，并且将此容器所依赖的镜像文件层按照先父后子的顺序，逐层挂载到此目录当中。隔离完成之后，不同的Mount Namespace之间的数据互不影响。同时，Docker 会将当前目录设置为read-only模式，对此目录所做出的所有写操作都将体现到另外一个目录，而这个目录也就是writable文件层。</p>
</blockquote>
<p>而LXC就是基于Linux内核通过调用CGroups 和Namespaces，来实现容器轻量级虚拟化的一项技术，与此同时，LXC也是一组面向Linux内核容器的用户态API接口。用户通过LXC提供的资源限制和隔离功能，可以创建一套完整并且相互隔离的虚拟应用运行环境。Docker就是采用LXC技术来创建容器的工具, 因此LXC是Docker运行的基础，而 <strong>docker则是LXC的杀手级应用</strong>。</p>
<h2 id="体系结构"><a href="#体系结构" class="headerlink" title="体系结构"></a>体系结构</h2><ul>
<li><strong>Docker Daemon</strong>：负责维护 Docker运行的守护进程，担负看资源官理、仕务调度等多项功能。</li>
<li><strong>Docker Image</strong>（镜像)：属于静态文件系统</li>
<li><strong>Docker Container</strong>（容器)：基于Image真正提供应用服务的计算单元。</li>
</ul>
<p>三者关系: Container 基于Image被 Daemon创建和管理，来实现提供服务的功能。因为Container负责提供服务，所以处于核心位置。因而当我们谈论到Docker生命周期时，更多的指的是Docker Container的生命周期。</p>
<blockquote>
<p>Docker Container的生命周期</p>
</blockquote>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211122210958992.png" alt="image-20211122210958992"></p>
<h2 id="Docker-Daemon主要任务"><a href="#Docker-Daemon主要任务" class="headerlink" title="Docker Daemon主要任务"></a>Docker Daemon主要任务</h2><ul>
<li>负责任务调度，它需要将客户端传来的命令请求转化为特定的任务。</li>
<li>负责维护镜像数据。一个完整的镜像由许多的子文件层组成，而这个镜像的依赖关系就是由 Daemon来维护的。</li>
<li>负责容器虚拟化。虚拟化是一个较大的概念，具体来说就是资源分配和资源隔离。</li>
<li>负责容器生命周期。Daemon需要根据用户指令和容器自身状态来维护容器的生命周期。</li>
</ul>
<blockquote>
<p>四项任务关系图</p>
</blockquote>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211122212748209.png" alt="image-20211122212748209"></p>
<p>Engine模块用来监听来自客户端的Restful API请求，Engine既可以通过unix:/来监听本地 socket 文件（默认是Docker.sock)，也可以通过tcp:/l的方式来监听某一个端口。当然也可以选择两种方式同时监听。</p>
<p>Engine模块会将接收到的命令请求转化为具体的Job，而转化的依据就是存放在Daemon当中的API路由表。每一个API都有唯一与之相对应的Handler函数，在此Handler函数中，会有一系列的逻辑来处理客户端请求。而负责处理请求的逻辑函数，在 Docker Daemon当中就以Job的形式运行。</p>
<p>Router、Handler和Job这三项共同组成了JobServer。而Engine每接收到一次来自于客户端的处理请求，就会生出一个 JobServer。当Job完成作业，并将数据返回给客户端之后，此JobServer也会随之销毁。</p>
<p>在Docker Daemon中，只有两种Job类型:Image Job和 Container Job。Image Job重点在于通过 AUFS 文件系统来维护镜像数据，而 Container Job则侧重于管理资源。</p>
<blockquote>
<p>Docker Daemon通过LXC管理资源的过程</p>
</blockquote>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211122213212201.png" alt="image-20211122213212201"></p>
<p>Daemon并不参与资源分配和隔离的工作，这些工作都是由虚拟化驱动来完成的。充当虚拟化驱动的有LXC、Libcontainer、Libvirt和 nspawn。（Libcontainer是Docker自行开发用于管理资源的驱动库，Docker最初使用LXC，后面替换为libcontainer。）Daemon通过驱动库来管理Cgroups、namespaces、SELinux等各个组件，然后再基于所创建的资源使用方案产生一个可用的容器。</p>
<p><a target="_blank" rel="noopener" href="http://dockone.io/article/1513">Docker五种存储驱动原理及应用场景和性能测试对比</a></p>
<blockquote>
<p>docker<strong>客户端</strong>与<strong>服务端</strong>交互大致流程</p>
</blockquote>
<p><img src="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/image-20211122220713188.png" alt="image-20211122220713188"></p>
<p>每一个 Docker CLI都必须通过<strong>Rest API</strong>的方式调用Docker Daemon完成某项特定的工作。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p>书：《Docker全攻略》</p>
<h1 id="END"><a href="#END" class="headerlink" title="END"></a>END</h1></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%83%A8%E7%BD%B2/">部署</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/09/17/wfu2n0.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/02/26/Springboot/%E6%A1%86%E6%9E%B6%E5%AD%A6%E4%B9%A0/"><img class="prev-cover" src="https://s3.ax1x.com/2020/12/01/D4plnJ.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">框架源码学习</div></div></a></div><div class="next-post pull-right"><a href="/2021/02/06/SQL/MySQL%E9%9B%86%E7%BE%A4/"><img class="next-cover" src="https://s1.ax1x.com/2020/09/26/0i22jI.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Mycat搭建MySQL集群实现高可用，读写分离</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/10/19/部署/打包vue项目部署到nginx/" title="打包vue项目部署到Nginx"><img class="cover" src="https://s1.ax1x.com/2020/09/17/wfi3MF.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-19</div><div class="title">打包vue项目部署到Nginx</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image: url(https://s1.ax1x.com/2020/09/17/wfu2n0.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2021 By CZM</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>由</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>提供支持</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'k2GMUzIrob4GbB5vtonkzLSO-gzGzoHsz',
      appKey: '6k8wcGzpepgvksNzrQlYU2W1',
      placeholder: '记得留下你的痕迹……',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/third-party/click_heart.js" async="async"></script><script src="/js/third-party/ClickShowText.js" async="async"></script></div></body></html>