<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kuberneteså­¦ä¹ ç¬”è®° | èœé¸Ÿæ˜Deåšå®¢</title><meta name="description" content="Kubernetes(k8s)â€‹        Kubernetes æ˜¯ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œå®ƒå…è®¸ä½ åœ¨å…¶ä¸Šå¾ˆå®¹æ˜“åœ°éƒ¨ç½²ç®¡ç†å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œå®ƒä¾èµ–äº Linux å®¹å™¨çš„ç‰¹æ€§æ¥è¿è¡Œåº”ç”¨ï¼Œ æ— é¡»çŸ¥é“è¿™äº›åº”ç”¨çš„å†…éƒ¨è¯¦æƒ…ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨å°†è¿™äº›åº”ç”¨éƒ¨ç½²åˆ°æ¯å°æœºå™¨ã€‚å› ä¸ºè¿™äº›åº”ç”¨è¿è¡Œåœ¨å®¹å™¨é‡Œï¼Œå®ƒä»¬ä¸ä¼šå½±å“è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–åº”ç”¨ ï¼Œå½“ä½ æ˜¯ä¸ºå®Œå…¨ä¸åŒçš„ç»„ç»‡æœºæ„è¿è¡Œåº”ç”¨æ—¶ï¼Œè¿™å°±å¾ˆå…³é”®äº† ã€‚è¿™å¯¹äºäº‘ä¾›åº”å•†æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸º"><meta name="keywords" content="éƒ¨ç½²"><meta name="author" content="CZM,2723081630@qq.com"><meta name="copyright" content="CZM"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://czmderepository.gitee.io/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="Kuberneteså­¦ä¹ ç¬”è®°"><meta property="og:url" content="https://czmderepository.gitee.io/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="èœé¸Ÿæ˜Deåšå®¢"><meta property="og:description" content="Kubernetes(k8s)â€‹        Kubernetes æ˜¯ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œå®ƒå…è®¸ä½ åœ¨å…¶ä¸Šå¾ˆå®¹æ˜“åœ°éƒ¨ç½²ç®¡ç†å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œå®ƒä¾èµ–äº Linux å®¹å™¨çš„ç‰¹æ€§æ¥è¿è¡Œåº”ç”¨ï¼Œ æ— é¡»çŸ¥é“è¿™äº›åº”ç”¨çš„å†…éƒ¨è¯¦æƒ…ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨å°†è¿™äº›åº”ç”¨éƒ¨ç½²åˆ°æ¯å°æœºå™¨ã€‚å› ä¸ºè¿™äº›åº”ç”¨è¿è¡Œåœ¨å®¹å™¨é‡Œï¼Œå®ƒä»¬ä¸ä¼šå½±å“è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–åº”ç”¨ ï¼Œå½“ä½ æ˜¯ä¸ºå®Œå…¨ä¸åŒçš„ç»„ç»‡æœºæ„è¿è¡Œåº”ç”¨æ—¶ï¼Œè¿™å°±å¾ˆå…³é”®äº† ã€‚è¿™å¯¹äºäº‘ä¾›åº”å•†æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸º"><meta property="og:image" content="https://s1.ax1x.com/2020/09/17/wfnWJH.jpg"><meta property="article:published_time" content="2021-12-05T09:33:00.000Z"><meta property="article:modified_time" content="2022-01-08T08:54:53.560Z"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.1.1',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  bookmark: {
    message_prev: 'æŒ‰',
    message_next: 'é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾'
  },
  runtime: '',
  date_suffix: {"one_hour":"åˆšåˆš","hours":"å°æ—¶å‰","day":"å¤©å‰"},
  copyright: undefined,
  ClickShowText: {"text":"å°å¸…å“¥,çˆ±ä½ ,è¿‡æµªé™©,æ¬¢è¿æ‚¨,è¿‡å‹è´´,å…‰ä¸´æœ¬å›­,åŠ æ²¹,åŠªåŠ›,é…·ç‚«ä½è°ƒå¥¢å,æ‹¼æ,forever,çˆ±ä½ ","fontSize":"15px"},
  medium_zoom: false,
  fancybox: true,
  Snackbar: {"bookmark":{"message_prev":"æŒ‰","message_next":"é”®å°†æœ¬é¡µåŠ å…¥ä¹¦ç­¾"},"chs_to_cht":"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“","cht_to_chs":"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“","day_to_night":"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼","night_to_day":"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼","bgLight":"#49b1f5","bgDark":"#121212","position":"bottom-left"},
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
    },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2022-01-08 16:54:53'
}</script><noscript><style type="text/css">
#nav {
  opacity: 1
}
.justified-gallery img {
  opacity: 1
}
</style></noscript><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
  }
}

var autoChangeMode = 'false'
var t = saveToLocal.get('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (saveToLocal.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><meta name="generator" content="Hexo 5.1.1"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">åŠ è½½ä¸­...</div></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://s1.ax1x.com/2020/09/17/wRG4fS.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length_num">56</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">ç›®å½•</div><div class="sidebar-toc__progress"><span class="progress-notice">ä½ å·²ç»è¯»äº†</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Kubernetes-k8s"><span class="toc-number">1.</span> <span class="toc-text">Kubernetes(k8s)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E5%8A%9F%E8%83%BD"><span class="toc-number">1.1.</span> <span class="toc-text">æ ¸å¿ƒåŠŸèƒ½</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">é›†ç¾¤æ¶æ„</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E9%9D%A2%E6%9D%BF"><span class="toc-number">1.2.1.</span> <span class="toc-text">æ§åˆ¶é¢æ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%8A%82%E7%82%B9"><span class="toc-number">1.2.2.</span> <span class="toc-text">å·¥ä½œèŠ‚ç‚¹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C%E5%BA%94%E7%94%A8"><span class="toc-number">1.3.</span> <span class="toc-text">è¿è¡Œåº”ç”¨</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8F%8F%E8%BF%B0%E4%BF%A1%E6%81%AF%E6%80%8E%E6%A0%B7%E6%88%90%E4%B8%BA%E4%B8%80%E4%B8%AA%E8%BF%90%E8%A1%8C%E7%9A%84%E5%AE%B9%E5%99%A8"><span class="toc-number">1.3.1.</span> <span class="toc-text">æè¿°ä¿¡æ¯æ€æ ·æˆä¸ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%8D%95%E6%9C%BAk8s"><span class="toc-number">1.4.</span> <span class="toc-text">åˆ›å»ºå•æœºk8s</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A6%81%E7%94%A8swap%E5%88%86%E5%8C%BA"><span class="toc-number">1.4.1.</span> <span class="toc-text">ç¦ç”¨swapåˆ†åŒº</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85kubectl"><span class="toc-number">1.4.2.</span> <span class="toc-text">å®‰è£…kubectl</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E8%A3%85minikube"><span class="toc-number">1.4.3.</span> <span class="toc-text">å®‰è£…minikube</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2"><span class="toc-number">1.4.4.</span> <span class="toc-text">éƒ¨ç½²</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E9%99%A4minikube%E6%95%B0%E6%8D%AE"><span class="toc-number">1.4.5.</span> <span class="toc-text">æ¸…é™¤minikubeæ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E9%9B%86%E7%BE%A4"><span class="toc-number">1.4.6.</span> <span class="toc-text">åˆ é™¤é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%81%9C%E6%AD%A2%E9%9B%86%E7%BE%A4"><span class="toc-number">1.4.7.</span> <span class="toc-text">åœæ­¢é›†ç¾¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8rc%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.8.</span> <span class="toc-text">ä½¿ç”¨rcåˆ›å»ºåº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E5%BA%94%E7%94%A8"><span class="toc-number">1.4.9.</span> <span class="toc-text">åˆ é™¤åº”ç”¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%A6%E7%BB%86%E4%BF%A1%E6%81%AF"><span class="toc-number">1.4.10.</span> <span class="toc-text">è¯¦ç»†ä¿¡æ¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BAnginx%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.11.</span> <span class="toc-text">åˆ›å»ºnginxæœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E5%8D%B0%E6%97%A5%E5%BF%97"><span class="toc-number">1.4.12.</span> <span class="toc-text">æ‰“å°æ—¥å¿—</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#pod"><span class="toc-number">1.5.</span> <span class="toc-text">pod</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#pod%E9%97%B4%E7%BD%91%E7%BB%9C"><span class="toc-number">1.5.1.</span> <span class="toc-text">podé—´ç½‘ç»œ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%91pod%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82"><span class="toc-number">1.5.2.</span> <span class="toc-text">å‘podå‘é€è¯·æ±‚</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Label%E6%A0%87%E7%AD%BE"><span class="toc-number">1.5.3.</span> <span class="toc-text">Labelæ ‡ç­¾</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.6.</span> <span class="toc-text">å‘½åç©ºé—´</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AE%9A%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.6.1.</span> <span class="toc-text">æŒ‡å®šå‘½åç©ºé—´</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E6%B4%BB%E6%8E%A2%E9%92%88-liveness-probe"><span class="toc-number">1.7.</span> <span class="toc-text">å­˜æ´»æ¢é’ˆ (liveness probe)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A2%E6%B5%8B%E6%9C%BA%E5%88%B6"><span class="toc-number">1.7.1.</span> <span class="toc-text">æ¢æµ‹æœºåˆ¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.7.2.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%B1%E7%BB%AA%E6%8E%A2%E9%92%88"><span class="toc-number">1.8.</span> <span class="toc-text">å°±ç»ªæ¢é’ˆ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-1"><span class="toc-number">1.8.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReplicationController%EF%BC%88rc%EF%BC%89"><span class="toc-number">1.9.</span> <span class="toc-text">ReplicationControllerï¼ˆrcï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%B0%83%E6%B5%81%E7%A8%8B"><span class="toc-number">1.9.1.</span> <span class="toc-text">åè°ƒæµç¨‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E4%B8%AA%E4%B8%BB%E8%A6%81%E9%83%A8%E5%88%86"><span class="toc-number">1.9.2.</span> <span class="toc-text">ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rc%E4%B8%8Epod%E5%85%B3%E7%B3%BB"><span class="toc-number">1.9.3.</span> <span class="toc-text">rcä¸podå…³ç³»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9rc%E4%B8%ADpod%E6%A8%A1%E6%9D%BF"><span class="toc-number">1.9.4.</span> <span class="toc-text">ä¿®æ”¹rcä¸­podæ¨¡æ¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%A9%E5%AE%B9"><span class="toc-number">1.9.5.</span> <span class="toc-text">æ‰©å®¹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%A0%E9%99%A4rc%E4%BF%9D%E6%8C%81pod%E8%BF%90%E8%A1%8C"><span class="toc-number">1.9.6.</span> <span class="toc-text">åˆ é™¤rcä¿æŒpodè¿è¡Œ</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReplicaSet-rs"><span class="toc-number">1.10.</span> <span class="toc-text">ReplicaSet(rs)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-2"><span class="toc-number">1.10.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#operator-%E8%BF%90%E7%AE%97%E7%AC%A6%EF%BC%89"><span class="toc-number">1.10.2.</span> <span class="toc-text">operator (è¿ç®—ç¬¦ï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DaemonSet%EF%BC%88ds%EF%BC%89"><span class="toc-number">1.11.</span> <span class="toc-text">DaemonSetï¼ˆdsï¼‰</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Service%E6%9C%8D%E5%8A%A1%EF%BC%88SVC%EF%BC%89"><span class="toc-number">1.12.</span> <span class="toc-text">ServiceæœåŠ¡ï¼ˆSVCï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-3"><span class="toc-number">1.12.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-FQDN-%E8%BF%9E%E6%8E%A5%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.12.2.</span> <span class="toc-text">é€šè¿‡ FQDN è¿æ¥æœåŠ¡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.12.3.</span> <span class="toc-text">è®¿é—®å¤–éƒ¨æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%A4%BA%E4%BE%8B-4"><span class="toc-number">1.12.3.1.</span> <span class="toc-text">ç¤ºä¾‹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%96%E9%83%A8%E6%9C%8D%E5%8A%A1%E5%88%9B%E5%BB%BA%E5%88%AB%E5%90%8D"><span class="toc-number">1.12.3.2.</span> <span class="toc-text">å¤–éƒ¨æœåŠ¡åˆ›å»ºåˆ«å</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9A%B4%E9%9C%B2%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.12.4.</span> <span class="toc-text">æš´éœ²æœåŠ¡</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%A7%8D%E6%96%B9%E5%BC%8F"><span class="toc-number">1.12.4.1.</span> <span class="toc-text">ä¸‰ç§æ–¹å¼</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83"><span class="toc-number">1.13.</span> <span class="toc-text">å‚è€ƒ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#END"><span class="toc-number">1.14.</span> <span class="toc-text">END</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://s1.ax1x.com/2020/09/17/wfnWJH.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">èœé¸Ÿæ˜Deåšå®¢</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ—¶é—´è½´</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> å‹é“¾</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> å…³äº</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Kuberneteså­¦ä¹ ç¬”è®°</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2021-12-05T09:33:00.000Z" title="å‘è¡¨äº 2021-12-05 17:33:00">2021-12-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2022-01-08T08:54:53.560Z" title="æ›´æ–°äº 2022-01-08 16:54:53">2022-01-08</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="Kubernetes-k8s"><a href="#Kubernetes-k8s" class="headerlink" title="Kubernetes(k8s)"></a>Kubernetes(k8s)</h1><p>â€‹        <a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/home/">Kubernetes</a> æ˜¯ä¸ªè½¯ä»¶ç³»ç»Ÿï¼Œå®ƒå…è®¸ä½ åœ¨å…¶ä¸Šå¾ˆå®¹æ˜“åœ°éƒ¨ç½²ç®¡ç†å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œå®ƒä¾èµ–äº <a href="/2021/02/07/%E9%83%A8%E7%BD%B2/docker/">Linux å®¹å™¨çš„ç‰¹æ€§</a>æ¥è¿è¡Œåº”ç”¨ï¼Œ æ— é¡»çŸ¥é“è¿™äº›åº”ç”¨çš„å†…éƒ¨è¯¦æƒ…ä¹Ÿä¸éœ€è¦æ‰‹åŠ¨å°†è¿™äº›åº”ç”¨éƒ¨ç½²åˆ°æ¯å°æœºå™¨ã€‚å› ä¸ºè¿™äº›åº”ç”¨è¿è¡Œåœ¨å®¹å™¨é‡Œï¼Œå®ƒä»¬ä¸ä¼šå½±å“è¿è¡Œåœ¨åŒä¸€å°æœåŠ¡å™¨ä¸Šçš„å…¶ä»–åº”ç”¨ ï¼Œå½“ä½ æ˜¯ä¸ºå®Œå…¨ä¸åŒçš„ç»„ç»‡æœºæ„è¿è¡Œåº”ç”¨æ—¶ï¼Œè¿™å°±å¾ˆå…³é”®äº† ã€‚è¿™å¯¹äºäº‘ä¾›åº”å•†æ¥è¯´æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿½æ±‚é«˜ç¡¬ä»¶å¯ç”¨çš„åŒæ—¶ä¹Ÿå¿…é¡»ä¿éšœæ‰€æ‰¿è½½åº”ç”¨å®Œå…¨éš”ç¦»ã€‚</p>
<h2 id="æ ¸å¿ƒåŠŸèƒ½"><a href="#æ ¸å¿ƒåŠŸèƒ½" class="headerlink" title="æ ¸å¿ƒåŠŸèƒ½"></a>æ ¸å¿ƒåŠŸèƒ½</h2><p>â€‹        æ•´ä¸ªç³»ç»Ÿç”±ä¸€ä¸ªä¸»èŠ‚ç‚¹å’Œè‹¥å¹²ä¸ªå·¥ä½œèŠ‚ç‚¹ç»„æˆå¼€å‘è€…æŠŠä¸€ä¸ªåº”ç”¨åˆ—è¡¨æäº¤åˆ°ä¸»èŠ‚ç‚¹ï¼ŒKubernetesä¼šå°†å®ƒä»¬éƒ¨ç½²åˆ°é›†ç¾¤çš„å·¥ä½œèŠ‚ç‚¹ã€‚ç»„ä»¶è¢«éƒ¨ç½²åœ¨å“ªä¸ªèŠ‚ç‚¹å¯¹äºå¼€å‘è€…å’Œç³»ç»Ÿç®¡ç†å‘˜æ¥è¯´éƒ½ä¸ç”¨å…³å¿ƒã€‚</p>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211205202340757.png" alt="image-20211205202340757"></p>
<h2 id="é›†ç¾¤æ¶æ„"><a href="#é›†ç¾¤æ¶æ„" class="headerlink" title="é›†ç¾¤æ¶æ„"></a>é›†ç¾¤æ¶æ„</h2><p>â€‹        åœ¨ç¡¬ä»¶çº§åˆ«ï¼Œä¸€ä¸ªKubernetes é›†ç¾¤ç”±å¾ˆå¤šèŠ‚ç‚¹ç»„æˆï¼Œè¿™äº›èŠ‚ç‚¹è¢«åˆ†æˆä»¥ä¸‹ä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li>ä¸»èŠ‚ç‚¹ ï¼Œå®ƒæ‰¿è½½ Kubernetes æ§åˆ¶å’Œç®¡ç†æ•´ä¸ªé›†ç¾¤ç³»ç»Ÿçš„æ§åˆ¶é¢æ¿ã€‚</li>
<li>å·¥ä½œèŠ‚ç‚¹ï¼Œå®ƒä»¬è¿è¡Œç”¨æˆ·å®é™…éƒ¨ç½²çš„åº”ç”¨ã€‚</li>
</ul>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211205202535863.png" alt="image-20211205202535863"></p>
<h3 id="æ§åˆ¶é¢æ¿"><a href="#æ§åˆ¶é¢æ¿" class="headerlink" title="æ§åˆ¶é¢æ¿"></a>æ§åˆ¶é¢æ¿</h3><p>â€‹        æ§åˆ¶é¢æ¿ç”¨äºæ§åˆ¶é›†ç¾¤å¹¶ä½¿å®ƒå·¥ä½œã€‚å®ƒåŒ…å«å¤šä¸ªç»„ä»¶ï¼Œç»„ä»¶å¯ä»¥è¿è¡Œåœ¨å•ä¸ªä¸»èŠ‚ç‚¹ä¸Šæˆ–è€…é€šè¿‡å‰¯æœ¬åˆ†åˆ«éƒ¨ç½²åœ¨å¤šä¸ªä¸»èŠ‚ç‚¹ä»¥ç¡®ä¿é«˜å¯ç”¨æ€§ã€‚è¿™äº›ç»„ä»¶æ˜¯</p>
<ul>
<li><code>Kubernetes API æœåŠ¡å™¨</code>ï¼šä½ å’Œå…¶ä»–æ§åˆ¶é¢æ¿ç»„ä»¶éƒ½è¦å’Œå®ƒé€šä¿¡ã€‚</li>
<li><code>Scheculer</code> ï¼šå®ƒè°ƒåº¦ä½ çš„åº”ç”¨ï¼ˆä¸ºåº”ç”¨çš„æ¯ä¸ªå¯éƒ¨ç½²ç»„ä»¶åˆ†é…ä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ï¼‰ã€‚</li>
<li><code>Controller Manager</code>ï¼šå®ƒæ‰§è¡Œé›†ç¾¤çº§åˆ«çš„åŠŸèƒ½ï¼Œå¦‚å¤åˆ¶ç»„ä»¶ã€æŒç»­è·Ÿè¸ªå·¥ä½œèŠ‚ç‚¹å¤„ç†èŠ‚ç‚¹å¤±è´¥ã€‚</li>
<li><code>etcd</code>ï¼šä¸€ä¸ªå¯é çš„åˆ†å¸ƒå¼æ•°æ®å­˜å‚¨ï¼Œå®ƒèƒ½æŒä¹…åŒ–å­˜å‚¨é›†ç¾¤é…ç½®ã€‚</li>
</ul>
<blockquote>
<p>æ§åˆ¶é¢æ¿çš„ç»„ä»¶æŒæœ‰å¹¶æ§åˆ¶é›†ç¾¤çŠ¶æ€ï¼Œä½†æ˜¯å®ƒä»¬ä¸è¿è¡Œä½ çš„åº”ç”¨ç¨‹åºã€‚è¿™æ˜¯ç”±å·¥ä½œèŠ‚ç‚¹å®Œæˆçš„ã€‚å·¥ä½œèŠ‚ç‚¹ä¸Šçš„ç»„ä»¶éƒ½éœ€è¦è¿è¡Œåœ¨åŒä¸€ ä¸ªèŠ‚ç‚¹ä¸Šï¼Œ æ§åˆ¶å¹³é¢çš„ç»„ä»¶å¯ä»¥è¢«ç®€å•åœ°åˆ†å‰²åœ¨å¤šå°æœåŠ¡å™¨ä¸Šã€‚ä¸ºäº†ä¿è¯é«˜å¯ç”¨æ€§ï¼Œ æ§åˆ¶å¹³é¢çš„æ¯ä¸ªç»„ä»¶å¯ä»¥æœ‰å¤šä¸ªå®ä¾‹ã€‚<code>etcd</code>å’ŒAPIæœåŠ¡å™¨çš„å¤šä¸ªå®ä¾‹å¯ä»¥åŒæ—¶å¹¶è¡Œå·¥ä½œï¼ˆ<strong>etcd</strong> ä½¿ç”¨ <strong>RAFT</strong> ä¸€è‡´æ€§ç®—æ³•æ¥ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼‰ï¼Œ ä½†æ˜¯ï¼Œ è°ƒåº¦å™¨å’Œæ§åˆ¶å™¨ç®¡ç†å™¨åœ¨ç»™å®šæ—¶é—´å†…åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹èµ·ä½œç”¨ ï¼Œå…¶ä»–å®ä¾‹å¤„äºå¾…å‘½æ¨¡å¼ã€‚</p>
<p>æ³¨ï¼šå¤šä¸ªè°ƒåº¦å™¨ï¼šå¯ä»¥åœ¨é›†ç¾¤ä¸­è¿è¡Œå¤šä¸ªè°ƒåº¦å™¨è€Œéå•ä¸ªã€‚ ç„¶åï¼Œ å¯¹æ¯ä¸€ä¸ª <strong>pod,</strong> å¯ä»¥é€šè¿‡åœ¨ <strong>pod</strong>ç‰¹æ€§ä¸­è®¾ç½®<strong>schedulerName</strong> å±æ€§æŒ‡å®šè°ƒåº¦å™¨æ¥è°ƒåº¦ç‰¹å®šçš„ <strong>pod</strong>ã€‚æœªè®¾ç½®è¯¥å±æ€§çš„ <strong>pod</strong> ç”± é»˜è®¤è°ƒåº¦å™¨<strong>default-scheduler</strong> è°ƒåº¦ã€‚</p>
</blockquote>
<h3 id="å·¥ä½œèŠ‚ç‚¹"><a href="#å·¥ä½œèŠ‚ç‚¹" class="headerlink" title="å·¥ä½œèŠ‚ç‚¹"></a>å·¥ä½œèŠ‚ç‚¹</h3><p>â€‹        å·¥ä½œèŠ‚ç‚¹æ˜¯è¿è¡Œå®¹å™¨åŒ–åº”ç”¨çš„æœºå™¨ã€‚è¿è¡Œã€ç›‘æ§å’Œ ç†åº”ç”¨æœåŠ¡çš„ä»»åŠ¡æ˜¯ç”±ä»¥ä¸‹ç»„ä»¶å®Œæˆçš„</p>
<ul>
<li><code>Docker</code> ã€<code>rtk</code>æˆ–<code>å…¶ä»–çš„å®¹å™¨ç±»å‹</code>ã€‚</li>
<li><code>Kubelet</code>: å®ƒä¸ API åŠ¡å™¨é€šä¿¡ï¼Œå¹¶ç®¡ç†å®ƒæ‰€åœ¨èŠ‚ç‚¹çš„å®¹å™¨ã€‚</li>
<li><code>Kubernetes Service Proxy</code> (kube-proxy)ï¼Œå®ƒè´Ÿè´£ç»„ä»¶ä¹‹é—´çš„è´Ÿè½½å‡è¡¡ç½‘ç»œæµé‡ã€‚</li>
</ul>
<blockquote>
<p><code>rtk</code>:</p>
<p>Dockeræ˜¯ç¬¬ä¸€ä¸ªä½¿å®¹å™¨æˆä¸ºä¸»æµçš„å®¹å™¨å¹³å°ã€‚ Dockeræœ¬èº«å¹¶ä¸æä¾›è¿›ç¨‹éš”ç¦»ï¼Œå®é™…ä¸Šå®¹å™¨éš”ç¦»æ˜¯åœ¨Linuxå†…æ ¸ä¹‹ä¸Šä½¿ç”¨è¯¸å¦‚Linuxå‘½åç©ºé—´å’Œcgroupsä¹‹ç±»çš„å†…æ ¸ç‰¹æ€§å®Œæˆçš„ï¼Œ Dockerä»…ç®€åŒ–äº†è¿™äº›ç‰¹æ€§çš„ä½¿ç”¨ã€‚åœ¨DockeræˆåŠŸåï¼Œ å¼€æ”¾å®¹å™¨è®¡åˆ’(OCI)å°±å¼€å§‹å›´ç»•å®¹å™¨æ ¼å¼å’Œè¿è¡Œæ—¶åˆ›å»ºäº†å¼€æ”¾å·¥ä¸šæ ‡å‡†ã€‚ Dockeræ˜¯è®¡åˆ’çš„ä¸€éƒ¨åˆ†ï¼Œ rkt (å‘éŸ³ä¸ºâ€rock-itâ€)åˆ™æ˜¯å¦å¤–ä¸€ä¸ªLinuxå®¹å™¨å¼•æ“ã€‚å’ŒDockerä¸€æ ·ï¼Œ rktä¹Ÿæ˜¯ä¸€ä¸ªè¿è¡Œå®¹å™¨çš„å¹³å°ï¼Œ å®ƒå¼ºè°ƒå®‰å…¨æ€§ã€ å¯æ„å»ºæ€§å¹¶éµä»å¼€æ”¾æ ‡å‡†ã€‚ å®ƒä½¿ç”¨OCIå®¹å™¨é•œåƒï¼Œ ç”šè‡³å¯ä»¥è¿è¡Œå¸¸è§„çš„Dockerå®¹å™¨é•œåƒã€‚</p>
</blockquote>
<h2 id="è¿è¡Œåº”ç”¨"><a href="#è¿è¡Œåº”ç”¨" class="headerlink" title="è¿è¡Œåº”ç”¨"></a>è¿è¡Œåº”ç”¨</h2><p>â€‹        ä¸ºäº†åœ¨ Kubernetes ä¸­è¿è¡Œåº”ç”¨ï¼Œé¦–å…ˆéœ€è¦å°†åº”ç”¨æ‰“åŒ…è¿›ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨é•œåƒï¼Œå†å°†é‚£äº›é•œåƒæ¨é€åˆ°é•œåƒä»“åº“ï¼Œç„¶åå°†åº”ç”¨çš„æè¿°å‘å¸ƒåˆ°<code> Kubenetes API æœåŠ¡å™¨</code>ã€‚</p>
<blockquote>
<p><code>åº”ç”¨çš„æè¿°</code>åŒ…æ‹¬è¯¸å¦‚å®¹å™¨é•œåƒæˆ–è€…åŒ…å«åº”ç”¨ç¨‹åºç»„ä»¶çš„å®¹å™¨é•œåƒã€è¿™äº›ç»„ä»¶å¦‚ä½•ç›¸äº’å…³è”ï¼Œä»¥åŠå“ªäº›ç»„ä»¶éœ€è¦åŒæ—¶è¿è¡Œåœ¨åŒä¸€ä¸ªèŠ‚ç‚¹ä¸Šå’Œå“ªäº›ç»„ä»¶ä¸éœ€è¦åŒæ—¶è¿è¡Œç­‰ä¿¡æ¯ã€‚æ­¤å¤–ï¼Œè¯¥æè¿°è¿˜åŒ…æ‹¬å“ªäº›ç»„ä»¶ä¸ºå†…éƒ¨æˆ–å¤–éƒ¨å®¢æˆ·æä¾›æœåŠ¡ä¸”åº”è¯¥é€šè¿‡å•ä¸ª IPåœ°å€æš´éœ² ï¼Œå¹¶ä½¿å…¶ä»–ç»„ä»¶å¯ä»¥å‘ç°</p>
</blockquote>
<h3 id="æè¿°ä¿¡æ¯æ€æ ·æˆä¸ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨"><a href="#æè¿°ä¿¡æ¯æ€æ ·æˆä¸ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨" class="headerlink" title="æè¿°ä¿¡æ¯æ€æ ·æˆä¸ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨"></a>æè¿°ä¿¡æ¯æ€æ ·æˆä¸ºä¸€ä¸ªè¿è¡Œçš„å®¹å™¨</h3><p>â€‹        å½“API æœåŠ¡å™¨å¤„ç†åº”ç”¨çš„æè¿°æ—¶ï¼Œè°ƒåº¦å™¨è°ƒåº¦æŒ‡å®šç»„çš„å®¹å™¨åˆ°å¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œè°ƒåº¦æ˜¯åŸºäºæ¯ç»„æ‰€éœ€çš„è®¡ç®—èµ„    æºï¼Œä»¥åŠè°ƒåº¦æ—¶æ¯ä¸ªèŠ‚ç‚¹æœªåˆ†é…çš„èµ„æºã€‚ç„¶åï¼Œé‚£äº›èŠ‚ç‚¹ä¸Šçš„ Kubelet æŒ‡ç¤ºå®¹å™¨è¿è¡Œæ—¶ï¼ˆä¾‹å¦‚ Docker ï¼‰æ‹‰å–æ‰€éœ€çš„é•œåƒå¹¶è¿è¡Œå®¹å™¨ã€‚</p>
<blockquote>
<p>åœ¨ Kubernetes ä¸­éƒ¨ç½²åº”ç”¨ç¨‹åºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåº”ç”¨æè¿°ç¬¦åˆ—å‡ºäº†å››ä¸ªå®¹å™¨ï¼Œå¹¶å°†å®ƒä»¬åˆ†ä¸º ç»„ï¼ˆè¿™äº›é›†åˆè¢«ç§°ä¸º pod ï¼‰ å‰ä¸¤ä¸ªpodåªåŒ…å«ä¸€ä¸ªå®¹å™¨ï¼Œè€Œæœ€åä¸€ä¸ªåŒ…å«ä¸¤ä¸ªã€‚è¿™æ„å‘³ç€ä¸¤ä¸ªå®¹å™¨éƒ½éœ€è¦åä½œè¿è¡Œ ï¼Œä¸åº”è¯¥ç›¸äº’éš”ç¦»ã€‚åœ¨æ¯ä¸ªpod æ—è¾¹ï¼Œè¿˜å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ•°å­—ï¼Œè¡¨ç¤ºéœ€è¦å¹¶è¡Œè¿è¡Œçš„æ¯ä¸ª pod å‰¯æœ¬æ•°é‡ã€‚åœ¨å‘ Kubernetes æäº¤æè¿°ç¬¦ä¹‹åï¼Œå®ƒå°†æŠŠæ¯ä¸ª pod çš„æŒ‡å®šå‰¯æœ¬æ•°è°ƒåº¦åˆ°å¯ç”¨çš„å·¥ä½œèŠ‚ç‚¹ä¸Šã€‚èŠ‚ç‚¹ä¸Šçš„ Kubelets å°†å‘ŠçŸ¥Dockerä»é•œåƒä»“åº“ä¸­æ‹‰å–å®¹å™¨é•œåƒäº•è¿è¡Œå®¹å™¨ã€‚<img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211205233952199.png" alt="image-20211205233952199"></p>
</blockquote>
<h2 id="åˆ›å»ºå•æœºk8s"><a href="#åˆ›å»ºå•æœºk8s" class="headerlink" title="åˆ›å»ºå•æœºk8s"></a>åˆ›å»ºå•æœºk8s</h2><h3 id="ç¦ç”¨swapåˆ†åŒº"><a href="#ç¦ç”¨swapåˆ†åŒº" class="headerlink" title="ç¦ç”¨swapåˆ†åŒº"></a>ç¦ç”¨swapåˆ†åŒº</h3><p>Kubernetes 1.8å¼€å§‹è¦æ±‚å…³é—­ç³»ç»Ÿçš„Swapï¼Œå¯æš‚æ—¶å…³é—­æˆ–æ°¸ä¹…ç¦ç”¨ï¼Œä½¿ç”¨ # free -m ç¡®è®¤swapæ˜¯å¦ä¸ºå¼€å¯çŠ¶æ€</p>
<ol>
<li>swapoff -a # æš‚æ—¶å…³é—­</li>
<li>vim /etc/fstab # æ³¨é‡Šæ‰swapé‚£ä¸€è¡Œ(SWAP è‡ªåŠ¨æŒ‚è½½)ï¼Œå¯æ°¸ä¹…ç¦ç”¨swapåˆ†åŒº</li>
</ol>
<h3 id="å®‰è£…kubectl"><a href="#å®‰è£…kubectl" class="headerlink" title="å®‰è£…kubectl"></a>å®‰è£…kubectl</h3><p>â€‹        kubectlç”¨äºè¿è¡ŒKubernetesé›†ç¾¤å‘½ä»¤çš„ç®¡ç†å·¥å…·ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ä½¿ç”¨curlä¸‹è½½</span></span><br><span class="line">curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.22.4/bin/linux/amd64/kubectl</span><br><span class="line"><span class="comment"># å¯æ‰§è¡Œæƒé™</span></span><br><span class="line">chmod +x ./kubectl</span><br><span class="line"><span class="comment"># å°†äºŒè¿›åˆ¶æ–‡ä»¶ç§»åˆ° PATH ä¸­</span></span><br><span class="line">mv ./kubectl /usr/<span class="built_in">local</span>/bin/kubectl</span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>kubectlå¸¸ç”¨å‘½ä»¤</strong></p>
<p>kubectl run hello-minikube â€“image=k8s.gcr.io/echoserver:1.4 â€“port=8080 # åˆ›å»ºpodå®¹å™¨</p>
<p>kubectl create -f ã€Ã—Ã—.yamlã€‘# ä»¥é…ç½®æ–‡ä»¶å½¢å¼åˆ›å»ºpodå®¹å™¨</p>
<p>kubectl exec ã€podnameã€‘ â€“  ã€å‘½ä»¤ã€‘#æŒ‡å®špodå†…éƒ¨æ‰§è¡ŒæŒ‡å®šå‘½ä»¤</p>
<p>kubectl get po -A # æŸ¥çœ‹podçŠ¶æ€</p>
<p>kubectl get nodes # åˆ—å‡ºé›†ç¾¤èŠ‚ç‚¹</p>
<p>kubectl describe node ã€nodeNameã€‘#æŸ¥çœ‹èŠ‚ç‚¹æ›´å¤šè¯¦ç»†ä¿¡æ¯</p>
<p>kubectl cluster-info #å±•ç¤ºé›†ç¾¤ä¿¡æ¯</p>
<p>kubectl delete all â€“all  #åˆ é™¤æ‰€æœ‰èµ„æºï¼Œ <strong>all</strong> æŒ‡å®šæ­£åœ¨åˆ é™¤æ‰€æœ‰èµ„æºç±»å‹ï¼Œ <strong>â€“all</strong> é€‰é¡¹æŒ‡å®šå°†åˆ é™¤æ‰€æœ‰èµ„æºå®ä¾‹è€Œä¸æ˜¯æŒ‰åç§°æŒ‡å®šå®ƒä»¬ã€‚ä½¿ç”¨ <strong>all</strong> å…³é”®å­—åˆ é™¤æ‰€æœ‰å†…å®¹å¹¶ä¸æ˜¯çœŸçš„å®Œå…¨åˆ é™¤æ‰€æœ‰å†…å®¹ã€‚ ä¸€äº›èµ„æºï¼ˆå¦‚Secretï¼‰ä¼šè¢«ä¿ç•™ä¸‹æ¥ï¼Œ å¹¶ä¸”éœ€è¦è¢«æ˜ç¡®æŒ‡å®šåˆ é™¤ã€‚</p>
</blockquote>
<h3 id="å®‰è£…minikube"><a href="#å®‰è£…minikube" class="headerlink" title="å®‰è£…minikube"></a>å®‰è£…minikube</h3><p>æ³¨ï¼š<strong>Minikube</strong> æ˜¯ä¸€ä¸ªæ„å»ºå•èŠ‚ç‚¹é›†ç¾¤çš„å·¥å…·ï¼Œå¯¹åƒæµ‹è¯•Kubeneteså’Œæœ¬åœ°å¼€å‘åº”ç”¨éƒ½éå¸¸æœ‰ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -Lo minikube https://storage.googleapis.com/minikube/releases/v1.24.0/minikube-linux-amd64 &amp;&amp; chmod +x minikube &amp;&amp; mv minikube /usr/<span class="built_in">local</span>/bin/</span><br></pre></td></tr></table></figure>

<h3 id="éƒ¨ç½²"><a href="#éƒ¨ç½²" class="headerlink" title="éƒ¨ç½²"></a>éƒ¨ç½²</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">minikube start --vm-driver=docker --registry-mirror=https://registry.docker-cn.com</span><br><span class="line">--memory=1800mb</span><br><span class="line"><span class="comment"># --registry-mirrorå‚æ•°ï¼ŒæŒ‡æ˜ä»dockerä¸­å›½åŒºçš„é•œåƒä¸‹è½½æ•°æ®ã€‚</span></span><br><span class="line"><span class="comment"># --memoryé™åˆ¶å†…å®¹ä½¿ç”¨</span></span><br><span class="line"><span class="comment"># --insecure-registryç§æœ‰ä»“åº“é•œåƒ</span></span><br><span class="line"><span class="comment"># è‹¥æŠ¥é”™ The &quot;docker&quot; driver should not be used with root privileges.</span></span><br><span class="line"><span class="comment"># ä¸å…è®¸rootèº«ä»½æ‰§è¡Œï¼Œè¯·åˆ‡æ¢ç”¨æˆ·å¹¶å°†è¯¥ç”¨æˆ·æ·»åŠ åˆ°dockerç”¨æˆ·ç»„</span></span><br><span class="line"><span class="comment"># è‹¥æ‹‰å–k8s.gcr.io/kube-apiserver:v1.22.3å‡ºé”™ï¼Œåˆ™ç”¨é˜¿é‡Œäº‘é•œåƒ</span></span><br><span class="line">minikube start --vm-driver=docker --image-repository=registry.aliyuncs.com/google_containers --memory=1800mb --insecure-registry=192.168.38.128:5000</span><br></pre></td></tr></table></figure>

<h3 id="æ¸…é™¤minikubeæ•°æ®"><a href="#æ¸…é™¤minikubeæ•°æ®" class="headerlink" title="æ¸…é™¤minikubeæ•°æ®"></a>æ¸…é™¤minikubeæ•°æ®</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf ~/.minikube</span><br></pre></td></tr></table></figure>

<blockquote>
<p>minikube config set memory 4096 # minikubeé»˜è®¤æƒ…å†µä¸‹ä»…åˆ†é…2GBçš„RAMï¼Œéœ€æ‰©å†…å­˜å¯ä½¿ç”¨æ­¤å‘½ä»¤</p>
<p>minikube dashboard # è®¿é—®minikubeé›†ç¾¤ä¸­è¿è¡Œçš„Kubernetesä»ªè¡¨æ¿</p>
<p>minikube service hello-minikube # ä½¿ç”¨minikubeå¯åœ¨æµè§ˆå™¨ä¸­è½»æ¾æ‰“å¼€æ­¤å¼€æ”¾èŠ‚ç‚¹</p>
<p>minikube start -p cluster2 # å¯åŠ¨ç¬¬äºŒä¸ªæœ¬åœ°é›†ç¾¤ï¼ˆæ³¨æ„ï¼šè£¸æœºå¯åŠ¨ï¼ˆæœ¬æ¬¡å®éªŒç¯å¢ƒï¼‰ä¸é€‚ç”¨ï¼‰</p>
<p>minikube stop # åœæ­¢æœ¬åœ°é›†ç¾¤</p>
<p>minikube delete # åˆ é™¤æœ¬åœ°é›†ç¾¤</p>
</blockquote>
<h3 id="åˆ é™¤é›†ç¾¤"><a href="#åˆ é™¤é›†ç¾¤" class="headerlink" title="åˆ é™¤é›†ç¾¤"></a>åˆ é™¤é›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minikube delete</span><br></pre></td></tr></table></figure>

<h3 id="åœæ­¢é›†ç¾¤"><a href="#åœæ­¢é›†ç¾¤" class="headerlink" title="åœæ­¢é›†ç¾¤"></a>åœæ­¢é›†ç¾¤</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">minikube stop</span><br></pre></td></tr></table></figure>

<h3 id="ä½¿ç”¨rcåˆ›å»ºåº”ç”¨"><a href="#ä½¿ç”¨rcåˆ›å»ºåº”ç”¨" class="headerlink" title="ä½¿ç”¨rcåˆ›å»ºåº”ç”¨"></a>ä½¿ç”¨rcåˆ›å»ºåº”ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ—§ç‰ˆ--generatorï¼ˆå·²ç»å¼ƒç”¨ï¼‰ è®©Kubenetes åˆ›å»ºReplicationController, è€Œä¸æ˜¯ deployment</span></span><br><span class="line">kubectl run kubia --image=192.168.38.128:5000/kubia  --port=8080 --generator=run/v1 replicationcontroller <span class="string">&quot;kubia&quot;</span> created</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ–°ç‰ˆï¼šä½¿ç”¨yamlæ–‡ä»¶åˆ›å»º</span></span><br><span class="line">kubia-rc.yaml</span><br><span class="line"><span class="comment"># apiVersion: v1 # Kubernetes APIç‰ˆæœ¬</span></span><br><span class="line"><span class="comment"># kind: ReplicationController # æè¿°èµ„æºç±»å‹</span></span><br><span class="line"><span class="comment"># metadata:		# å…ƒæ•°æ®ï¼ˆåç§°ã€æ ‡ç­¾å’Œæ³¨è§£ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">#   name: kubia # åç§°</span></span><br><span class="line"><span class="comment"># spec:		#pod è§„æ ¼ï¼å†…å®¹ï¼ˆpod çš„å®¹å™¨åˆ—è¡¨ã€ volume ç­‰ï¼‰</span></span><br><span class="line"><span class="comment">#   replicas: 1  #podå®ä¾‹çš„ç›®æ ‡æ•°ç›®</span></span><br><span class="line"><span class="comment">#   selector:</span></span><br><span class="line"><span class="comment">#     app: kubia #podé€‰æ‹©å™¨å†³å®šäº†RCçš„æ“ä½œå¯¹è±¡</span></span><br><span class="line"><span class="comment">#   template:    #åˆ›å»ºpodæ‰€ç”¨æ¨¡æ¿</span></span><br><span class="line"><span class="comment">#     metadata:</span></span><br><span class="line"><span class="comment">#       labels:</span></span><br><span class="line"><span class="comment">#         app: kubia</span></span><br><span class="line"><span class="comment">#     spec:</span></span><br><span class="line"><span class="comment">#       containers:</span></span><br><span class="line"><span class="comment">#       - name: kubia</span></span><br><span class="line"><span class="comment">#         image: 192.168.38.128:5000/kubia</span></span><br><span class="line"><span class="comment">#         ports:</span></span><br><span class="line"><span class="comment">#         - containerPort: 8080</span></span><br><span class="line">kubectl create -f kubia-rc.yaml</span><br><span class="line"></span><br><span class="line">[czm@localhost ~]$ kubectl get pods</span><br><span class="line"><span class="comment"># -o wideé€‰é¡¹æ˜¾ç¤ºå…¶ä»–åˆ—</span></span><br><span class="line"><span class="comment"># -o yaml/json ä»¥yaml/jsonå±•ç¤ºpodçš„å®Œæ•´æè¿°ä¿¡æ¯</span></span><br><span class="line"><span class="comment"># --show-labels æ˜¾ç¤ºpodæ‰€æœ‰æ ‡ç­¾ / -L bale1,label2,â€¦â€¦ä»…æ˜¾ç¤ºæŒ‡å®šæ ‡ç­¾</span></span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">kubia   1/1     Running   0          47s</span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤åº”ç”¨"><a href="#åˆ é™¤åº”ç”¨" class="headerlink" title="åˆ é™¤åº”ç”¨"></a>åˆ é™¤åº”ç”¨</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete rc kubia</span><br><span class="line"><span class="comment"># ä¸æŒ‡å®šrcï¼ˆReplicationControllerï¼‰podä¼šå‚é‡æ–°åˆ›å»º</span></span><br><span class="line"><span class="comment"># rcçš„åˆ›å»ºä¸ä¼šç›´æ¥åˆ›å»ºpodï¼Œè€Œæ˜¯å…ˆå»ºä¸€ä¸ªReplicationControllerï¼Œç„¶åå†ç”±ReplicationControlleråˆ›å»ºpodï¼Œåªè¦åˆ é™¤ç”±è¯¥ReplicationControlleråˆ›å»ºçš„podï¼Œå®ƒä¾¿ä¼šç«‹å³åˆ›å»ºä¸€ä¸ªæ–°çš„podï¼Œå¦‚æœæƒ³è¦åˆ é™¤è¯¥podï¼Œéœ€è¦åˆ é™¤è¿™ä¸ªReplicationController</span></span><br></pre></td></tr></table></figure>

<h3 id="è¯¦ç»†ä¿¡æ¯"><a href="#è¯¦ç»†ä¿¡æ¯" class="headerlink" title="è¯¦ç»†ä¿¡æ¯"></a>è¯¦ç»†ä¿¡æ¯</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[czm@control-plane app]$ kubectl describe pod nginx</span><br><span class="line">Name:         nginx</span><br><span class="line">Namespace:    default</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         minikube/192.168.58.2</span><br><span class="line">Start Time:   Tue, 07 Dec 2021 18:57:39 +0800</span><br><span class="line">Labels:       app=myapp</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Running</span><br><span class="line">â€¦â€¦</span><br></pre></td></tr></table></figure>

<p>æ¯ä¸ª pod éƒ½æœ‰è‡ªå·±çš„ IP åœ°å€ï¼Œä½†æ˜¯è¿™ä¸ªåœ°å€æ˜¯é›†ç¾¤ å†…éƒ¨çš„ï¼Œä¸èƒ½ä»é›†ç¾¤å¤–éƒ¨è®¿é—® ã€‚è¦è®© pod èƒ½å¤Ÿä»å¤–éƒ¨è®¿é—® éœ€è¦é€šè¿‡æœåŠ¡å¯¹è±¡å…¬å¼€å®ƒï¼Œ åˆ›å»º ç‰¹æ®Š LoadBalancer ç±»å‹çš„æœåŠ¡ã€‚é€šè¿‡LoadBalancerç±»å‹çš„æœåŠ¡ï¼Œå°†åˆ›å»ºä¸€ä¸ªå¤–éƒ¨çš„è´Ÿè½½å‡è¡¡ï¼Œå¯ä»¥é€šè¿‡è´Ÿè½½å‡è¡¡çš„å…¬å…± IP è®¿é—® pod</p>
<blockquote>
<h3 id="åˆ›å»ºnginxæœåŠ¡"><a href="#åˆ›å»ºnginxæœåŠ¡" class="headerlink" title="åˆ›å»ºnginxæœåŠ¡"></a>åˆ›å»º<code>nginx</code>æœåŠ¡</h3><p><code>nginx-rc.yaml </code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">     <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">   	<span class="attr">containers:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">       <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">       <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">       <span class="attr">ports:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[czm@control-plane app]$ kubectl create -f nginx-rc.yaml</span><br><span class="line">nginx created</span><br><span class="line">[czm@control-plane app]$ kubectl expose pod nginx --port=80 --<span class="built_in">type</span>=NodePort</span><br><span class="line">[czm@control-plane app]$ kubectl get services</span><br><span class="line">NAME         TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">kubernetes   ClusterIP   10.96.0.1     &lt;none&gt;        443/TCP        9h</span><br><span class="line">nginx        NodePort    10.100.4.38   &lt;none&gt;        80:30624/TCP   62m</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®æœåŠ¡</span></span><br><span class="line">[czm@control-plane ~]$ minikube service nginx</span><br><span class="line">|-----------|-------|-------------|---------------------------|</span><br><span class="line">| NAMESPACE | NAME  | TARGET PORT |            URL            |</span><br><span class="line">|-----------|-------|-------------|---------------------------|</span><br><span class="line">| default   | nginx |          80 | http://192.168.58.2:30624 |</span><br><span class="line">|-----------|-------|-------------|---------------------------|</span><br><span class="line">ğŸ‰  æ­£é€šè¿‡é»˜è®¤æµè§ˆå™¨æ‰“å¼€æœåŠ¡ default/nginx...</span><br><span class="line">This tool has been deprecated, use <span class="string">&#x27;gio open&#x27;</span> instead.</span><br><span class="line">See <span class="string">&#x27;gio help open&#x27;</span> <span class="keyword">for</span> more info.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211208010529364.png" alt="image-20211208010529364"></p>
</blockquote>
<h3 id="æ‰“å°æ—¥å¿—"><a href="#æ‰“å°æ—¥å¿—" class="headerlink" title="æ‰“å°æ—¥å¿—"></a>æ‰“å°æ—¥å¿—</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#podæ—¥å¿—</span></span><br><span class="line">kubectl logs [podName]</span><br><span class="line"><span class="comment">#æ—¥å¿—ç®¡ç†å·¥å…·journalctlæ˜¯centos7ä¸Šä¸“æœ‰çš„æ—¥å¿—ç®¡ç†å·¥å…·ï¼Œè¯¥å·¥å…·æ˜¯ä»messageè¿™ä¸ªæ–‡ä»¶é‡Œè¯»å–ä¿¡æ¯ã€‚Systemdç»Ÿä¸€ç®¡ç†æ‰€æœ‰Unitçš„å¯åŠ¨æ—¥å¿—ã€‚å¸¦æ¥çš„å¥½å¤„å°±æ˜¯ï¼Œå¯ä»¥åªç”¨journalctlä¸€ä¸ªå‘½ä»¤ï¼ŒæŸ¥çœ‹æ‰€æœ‰æ—¥å¿—ï¼ˆå†…æ ¸æ—¥å¿—å’Œåº”ç”¨æ—¥å¿—ï¼‰ã€‚minikubeå¯åŠ¨å¤±è´¥å¯ä»¥é€šè¿‡æ­¤æŸ¥çœ‹</span></span><br><span class="line">journalctl -f</span><br></pre></td></tr></table></figure>

<h2 id="pod"><a href="#pod" class="headerlink" title="pod"></a>pod</h2><p>â€‹        podæ˜¯ä¸€ç»„å¹¶ç½®çš„å®¹å™¨ï¼Œ ä»£è¡¨äº†Kubenetesä¸­çš„åŸºæœ¬æ„å»ºæ¨¡å—ï¼ˆéƒ¨ç½²å•å…ƒï¼‰ã€‚å°†å¤šä¸ªè¿›ç¨‹èšé›†åœ¨ä¸€ä¸ªå•ç‹¬çš„å®¹å™¨ä¸­ï¼Œå¹¶å°†å®ƒä»¬ä½œä¸ºä¸€ä¸ªå•å…ƒè¿›è¡Œç®¡ç†ï¼Œè¿™å°±æ˜¯ <strong>pod</strong> èƒŒåçš„æ ¹æœ¬åŸç†ã€‚<strong>Kubenetes</strong> é€šè¿‡é…ç½® <strong>Docker</strong> æ¥è®©ä¸€ä¸ª <strong>pod</strong> å†…çš„æ‰€æœ‰å®¹å™¨å…±äº«ç›¸åŒçš„ <strong>Linux</strong> å‘½åç©ºé—´ï¼Œä¸€ä¸ª <strong>pod</strong> ä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½åœ¨ç›¸åŒçš„ <strong>network</strong> å’Œ <strong>UTS</strong> å‘½åç©ºé—´ä¸‹è¿è¡Œï¼Œ å…±äº«ç›¸åŒçš„ä¸»æœºåå’Œç½‘ç»œæ¥å£ã€‚ åŒæ ·åœ°ï¼Œ è¿™äº›å®¹å™¨ä¹Ÿéƒ½åœ¨ç›¸åŒçš„ <strong>IPC</strong> å‘½åç©ºé—´ä¸‹è¿è¡Œï¼Œ å› æ­¤èƒ½å¤Ÿé€šè¿‡ <strong>IPC</strong> è¿›è¡Œé€šä¿¡ã€‚ åœ¨æœ€æ–°çš„ <strong>Kubernetes</strong> å’Œ <strong>Docker</strong> ç‰ˆæœ¬ä¸­ï¼Œ å®ƒä»¬ä¹Ÿèƒ½å¤Ÿå…±äº«ç›¸åŒçš„ <strong>PID</strong> å‘½åç©ºé—´ï¼ˆé»˜è®¤æ˜¯æœªæ¿€æ´»ï¼‰</p>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211207195731891.png" alt="ä¸€ä¸ªpodç»ä¸ä¼šè·¨è¶Šå¤šä¸ªå·¥ä½œèŠ‚ç‚¹"></p>
<h3 id="podé—´ç½‘ç»œ"><a href="#podé—´ç½‘ç»œ" class="headerlink" title="podé—´ç½‘ç»œ"></a>podé—´ç½‘ç»œ</h3><p>â€‹        <strong>Kubernetes</strong> é›†ç¾¤ä¸­çš„æ‰€æœ‰ <strong>pod</strong> éƒ½åœ¨åŒä¸€ä¸ªå…±äº«ç½‘ç»œåœ°å€ç©ºé—´ä¸­ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤º)ï¼Œ å®ƒä»¬ä¹‹é—´æ²¡æœ‰ <strong>NAT</strong> (ç½‘ç»œåœ°å€è½¬æ¢ï¼‰ ç½‘å…³ï¼Œæ¯ä¸ª <strong>pod</strong> éƒ½å¯ä»¥é€šè¿‡å…¶ä»– <strong>pod</strong> çš„ IP åœ°å€æ¥å®ç°ç›¸äº’è®¿é—®ã€‚ å½“ä¸¤ä¸ª pod å½¼æ­¤ä¹‹é—´å‘é€ç½‘ç»œæ•°æ®åŒ…æ—¶ï¼Œ å®ƒä»¬éƒ½ä¼šå°†å¯¹æ–¹çš„<strong>å®é™… IPåœ°å€</strong>çœ‹ä½œæ•°æ®åŒ…ä¸­çš„æº <strong>IP</strong>ã€‚</p>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211208004339687.png" alt="å¹³é¢ç½‘ç»œ"></p>
<h3 id="å‘podå‘é€è¯·æ±‚"><a href="#å‘podå‘é€è¯·æ±‚" class="headerlink" title="å‘podå‘é€è¯·æ±‚"></a>å‘podå‘é€è¯·æ±‚</h3><ol>
<li><p>é€šè¿‡åˆ›å»ºserviceè¿›è¡Œè®¿é—®ã€‚</p>
</li>
<li><p>æ‰§è¡Œ<code>kubectl port-forward </code>è½¬å‘æœ¬åœ°ç«¯å£è½¬å‘åˆ°æŒ‡å®špodç«¯å£ï¼ˆæµ‹è¯•å¸¸ç”¨ï¼‰ã€‚</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[czm@control-plane app]$ kubectl port-forward nginx 8000:80</span><br><span class="line">Forwarding from 127.0.0.1:8000 -&gt; 80</span><br><span class="line">Forwarding from [::1]:8000 -&gt; 80</span><br><span class="line">Handling connection <span class="keyword">for</span> 8000</span><br><span class="line">Handling connection <span class="keyword">for</span> 8000</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="Labelæ ‡ç­¾"><a href="#Labelæ ‡ç­¾" class="headerlink" title="Labelæ ‡ç­¾"></a>Labelæ ‡ç­¾</h3><p>â€‹        æ ‡è®°ä¸€ç±»podæˆ–æ‹¥æœ‰ç‰¹å®šèµ„æºnodeèŠ‚ç‚¹ï¼Œæ ‡ç­¾é€‰æ‹©å™¨å…è®¸æˆ‘ä»¬é€‰æ‹©æ ‡è®°æœ‰ç‰¹å®šæ ‡ç­¾çš„podå­é›†ï¼Œ å¹¶å¯¹è¿™äº›podæ‰§è¡Œæ“ä½œã€‚ </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ æ ‡ç­¾</span></span><br><span class="line">kubectl label po ã€podNameã€‘ ã€æ ‡ç­¾å=æ ‡ç­¾å€¼ã€‘</span><br><span class="line"><span class="comment"># ä¿®æ”¹æ ‡ç­¾å€¼</span></span><br><span class="line">kubectl label po ã€podNameã€‘ ã€æ ‡ç­¾å=æ ‡ç­¾å€¼ã€‘ --overwrite</span><br><span class="line"><span class="comment"># åˆ—å‡ºåŒ…å«envæ ‡ç­¾çš„æ‰€æœ‰pod</span></span><br><span class="line">kubectl get po -1 env</span><br><span class="line"><span class="comment"># åˆ—å‡ºæ²¡æœ‰envæ ‡ç­¾çš„æ‰€æœ‰pod</span></span><br><span class="line">kubectl get po -1 <span class="string">&#x27;!env&#x27;</span></span><br><span class="line"><span class="comment"># é€‰æ‹©å¸¦æœ‰envæ ‡ç­¾ä¸”å€¼ä¸ºprodæˆ–develçš„pod</span></span><br><span class="line">kubectl get po env <span class="keyword">in</span> (prod, devel)</span><br><span class="line"><span class="comment"># é€‰æ‹©å¸¦æœ‰envæ ‡ç­¾ï¼Œ ä½†å…¶å€¼ä¸æ˜¯prodæˆ–develçš„pod</span></span><br><span class="line">kubectl get po env notin (prod, devel)</span><br><span class="line"><span class="comment"># åˆ é™¤envæ ‡ç­¾æ˜¯prodçš„æ‰€æœ‰pod</span></span><br><span class="line">kubectl delete po - 1 env=prod</span><br></pre></td></tr></table></figure>

<p><strong>å°†podè°ƒåº¦åˆ°ç‰¹å®šèŠ‚ç‚¹</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ä¸ºä¸€ç±»èŠ‚ç‚¹æ·»åŠ æ ‡ç­¾ï¼Œå¹¶åœ¨podçš„yamlæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line"> <span class="attr">nodeSelector:</span></span><br><span class="line">  <span class="string">æ ‡ç­¾key:</span> <span class="string">æ ‡ç­¾å€¼</span></span><br></pre></td></tr></table></figure>

<p>æ³¨ï¼šé™¤æ ‡ç­¾å¤–ï¼Œpodå’Œå…¶ä»–å¯¹è±¡è¿˜å¯ä»¥åŒ…å«æ³¨è§£ã€‚æ³¨è§£ä¹Ÿæ˜¯é”®å€¼å¯¹ï¼Œä½†ä¸æ ‡ç­¾ä¸åŒï¼Œæ³¨è§£å¹¶ä¸æ˜¯ä¸ºäº†ä¿å­˜æ ‡è¯†ä¿¡æ¯è€Œå­˜åœ¨çš„ï¼Œå®ƒä»¬ä¸èƒ½åƒæ ‡ç­¾ä¸€æ ·ç”¨äºå¯¹å¯¹è±¡è¿›è¡Œåˆ†ç»„ã€‚å½“æˆ‘ä»¬å¯ä»¥é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨é€‰æ‹©å¯¹è±¡æ—¶ï¼Œå°±ä¸å­˜åœ¨æ³¨è§£é€‰æ‹©å™¨è¿™æ ·çš„ä¸œè¥¿ã€‚</p>
<h2 id="å‘½åç©ºé—´"><a href="#å‘½åç©ºé—´" class="headerlink" title="å‘½åç©ºé—´"></a>å‘½åç©ºé—´</h2><p>â€‹        Kuberneteså‘½åç©ºé—´ç®€å•åœ°ä¸ºå¯¹è±¡åç§°æä¾›äº†ä¸€ä¸ªä½œç”¨åŸŸï¼Œä¸åŒçš„å‘½åç©ºé—´å¯ä»¥åŒ…å«åŒåçš„èµ„æºã€‚namespace ä½¿æˆ‘ä»¬èƒ½å¤Ÿå°†ä¸å±äºä¸€ç»„çš„èµ„æºåˆ†åˆ°ä¸é‡å çš„ç»„ä¸­ï¼ˆå¦‚æŒ‰ç”¨æˆ·è¿›è¡Œåˆ†ç»„ï¼‰ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åˆ—å‡ºé›†ç¾¤ä¸­çš„æ‰€æœ‰å‘½åç©ºé—´</span></span><br><span class="line">kubectl get ns</span><br><span class="line"><span class="comment"># åˆ—å‡ºåªå±äºdefaultå‘½åç©ºé—´çš„podï¼ˆå¯ä»¥ä½¿ç”¨-næ¥ä»£æ›¿ --namespaceï¼‰</span></span><br><span class="line">kubectl get po --namespace default</span><br><span class="line"><span class="comment"># åˆ›å»ºczmå‘½åç©ºé—´</span></span><br><span class="line">kubectl create namespace czm</span><br><span class="line"><span class="comment"># åˆ é™¤å‘½åç©ºé—´ï¼Œæ‰€å±çš„podä¹Ÿä¼šåˆ é™¤</span></span><br><span class="line">kubectl delete ns czm</span><br></pre></td></tr></table></figure>

<h3 id="æŒ‡å®šå‘½åç©ºé—´"><a href="#æŒ‡å®šå‘½åç©ºé—´" class="headerlink" title="æŒ‡å®šå‘½åç©ºé—´"></a>æŒ‡å®šå‘½åç©ºé—´</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1.åˆ›å»ºæ—¶æŒ‡å®š</span></span><br><span class="line">kubectl create -f nginx.yaml -n czm</span><br><span class="line"><span class="comment"># 2. ç›´æ¥yamlä¸­æŒ‡å®š</span></span><br><span class="line">metadata:</span><br><span class="line"> namespace: czm</span><br></pre></td></tr></table></figure>



<h2 id="å­˜æ´»æ¢é’ˆ-liveness-probe"><a href="#å­˜æ´»æ¢é’ˆ-liveness-probe" class="headerlink" title="å­˜æ´»æ¢é’ˆ (liveness probe)"></a>å­˜æ´»æ¢é’ˆ <strong>(liveness probe)</strong></h2><p>â€‹    k8sé€šè¿‡å­˜è´§æ¢é’ˆæ£€æŸ¥å®¹å™¨æ˜¯å¦è¿˜åœ¨è¿è¡Œã€‚ å¯ä»¥ä¸º <strong>pod</strong> ä¸­çš„æ¯ä¸ªå®¹å™¨å•ç‹¬æŒ‡å®šå­˜æ´»æ¢é’ˆã€‚ å¦‚æœæ¢æµ‹å¤±è´¥ï¼Œk8så°†å®šæœŸæ‰§è¡Œæ¢é’ˆå¹¶é‡æ–°å¯åŠ¨å®¹å™¨ã€‚æ¢æµ‹ä»»åŠ¡ç”±æ‰¿è½½podçš„èŠ‚ç‚¹ä¸Šçš„<strong>Kubelet</strong> æ‰§è¡Œã€‚</p>
<h3 id="æ¢æµ‹æœºåˆ¶"><a href="#æ¢æµ‹æœºåˆ¶" class="headerlink" title="æ¢æµ‹æœºåˆ¶"></a>æ¢æµ‹æœºåˆ¶</h3><ul>
<li><p><strong>HTTP GET</strong>ï¼šå¯¹å®¹å™¨å‘èµ·getè¯·æ±‚ï¼Œå“åº”çŠ¶æ€ç æ˜¯2xxæˆ–3xx, åˆ™è®¤ä¸ºæ¢æµ‹æˆåŠŸã€‚å¦‚æœæœåŠ¡å™¨è¿”å›é”™è¯¯å“åº”çŠ¶æ€</p>
<p>  ç æˆ–è€…æ ¹æœ¬æ²¡æœ‰å“åº”ï¼Œé‚£ä¹ˆæ¢æµ‹å°±è¢«è®¤ä¸ºæ˜¯å¤±è´¥çš„ï¼Œå®¹å™¨å°†è¢«é‡æ–°å¯åŠ¨ã€‚</p>
</li>
<li><p><strong>TCP</strong>ï¼šå¥—æ¥å­—æ¢é’ˆå°è¯•ä¸å®¹å™¨æŒ‡å®šç«¯å£å»ºç«‹TCPè¿æ¥ã€‚å¦‚æœè¿æ¥æˆåŠŸå»ºç«‹ï¼Œåˆ™æ¢æµ‹æˆåŠŸã€‚å¦åˆ™å¤±è´¥</p>
</li>
<li><p><strong>Exec</strong>ï¼šæ¢é’ˆåœ¨å®¹å™¨å†…æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå¹¶æ£€æŸ¥å‘½ä»¤çš„é€€å‡ºçŠ¶æ€ç ã€‚å¦‚æœçŠ¶æ€ç æ˜¯ <strong>0</strong>, åˆ™æ¢æµ‹æˆåŠŸã€‚æ‰€æœ‰å…¶ä»–çŠ¶æ€ç éƒ½è¢«è®¤ä¸ºå¤±è´¥ã€‚</p>
</li>
</ul>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span> </span><br><span class="line"> 	<span class="attr">containers:</span></span><br><span class="line">      <span class="attr">livenessProbe:</span> </span><br><span class="line">        <span class="attr">httpGet:</span> <span class="comment">#HTTP GET å­˜æ´»æ¢æµ‹é’ˆ</span></span><br><span class="line">            <span class="attr">path:</span> <span class="string">/</span> <span class="comment">#æ¢æµ‹è·¯å¾„</span></span><br><span class="line">            <span class="attr">port:</span> <span class="number">8080</span> <span class="comment">#ç«¯å£</span></span><br><span class="line">        <span class="attr">initialDelaySeconds:</span> <span class="number">15</span> <span class="comment"># Kubernetesä¼šåœ¨ç¬¬â€”æ¬¡æ¢æµ‹å‰ç­‰å¾…15ç§’</span></span><br></pre></td></tr></table></figure>

<h2 id="å°±ç»ªæ¢é’ˆ"><a href="#å°±ç»ªæ¢é’ˆ" class="headerlink" title="å°±ç»ªæ¢é’ˆ"></a>å°±ç»ªæ¢é’ˆ</h2><p>â€‹        å°±ç»ªæ¢é’ˆçš„ç±»å‹ä¸å­˜æ´»æ¢é’ˆä¸€æ ·ä¸‰ç§ã€‚ä¸å­˜æ´»æ¢é’ˆä¸åŒçš„æ˜¯å¦‚æœå®¹å™¨æœªé€šè¿‡å‡†å¤‡æ£€ ï¼Œä¸ä¼šè¢«ç»ˆæ­¢æˆ–é‡æ–°å¯åŠ¨ã€‚å¯åŠ¨å®¹å™¨æ—¶ï¼Œå¯ä»¥ä¸º bernetes é…ç½® ç­‰å¾…æ—¶é—´ï¼Œç»è¿‡ç­‰å¾…æ—¶é—´åæ‰å¯ä»¥æ‰§è¡Œç¬¬ä¸€æ¬¡å‡†å¤‡å°±ç»ªæ£€æŸ¥ä¹‹åï¼Œå®ƒä¼šå‘¨æœŸæ€§åœ°è°ƒç”¨æ¢é’ˆï¼ˆé»˜è®¤æƒ…å†µä¸‹æ¯<strong>10</strong> ç§’æ£€æŸ¥ä¸€æ¬¡ï¼‰ï¼Œå¹¶æ ¹æ®å°±ç»ªæ¢é’ˆçš„ç»“æœé‡‡å–è¡ŒåŠ¨ã€‚å¦‚æœæŸä¸ª podæŠ¥å‘Šå®ƒå°šæœªå‡†å¤‡å°±ç»ªï¼Œåˆ™ä¼šä»è¯¥æœåŠ¡ä¸­åˆ é™¤è¯¥pod ã€‚å¦‚æœå†æ¬¡å‡†å¤‡å°±ç»ªï¼Œåˆ™é‡æ–°æ·»åŠ  podã€‚</p>
<h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span> </span><br><span class="line">	<span class="attr">containers:</span></span><br><span class="line">	<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubia</span></span><br><span class="line">		<span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br><span class="line">		<span class="attr">readinessProbe:</span></span><br><span class="line">			<span class="attr">exec:</span>  </span><br><span class="line">				<span class="attr">command:</span> </span><br><span class="line">				<span class="bullet">-</span> <span class="string">ls</span> </span><br><span class="line">				<span class="bullet">-</span> <span class="string">/var/ready</span></span><br><span class="line"><span class="comment">#å°±ç»ªæ¢é’ˆå°†å®šæœŸåœ¨å®¹å™¨å†…æ‰§è¡Œls/var/readyå‘½ä»¤ã€‚å¦‚æœæ–‡ä»¶å­˜åœ¨ï¼Œåˆ™lså‘½ä»¤è¿”å›é€€å‡ºç 0ï¼Œåˆ™å°±ç»ªæ¢é’ˆå°†æˆåŠŸï¼Œå¦åˆ™è¿”å›éé›¶çš„é€€å‡ºç ï¼Œå°±ç»ªæ¢é’ˆå¤±è´¥ã€‚</span></span><br></pre></td></tr></table></figure>



<h2 id="ReplicationControllerï¼ˆrcï¼‰"><a href="#ReplicationControllerï¼ˆrcï¼‰" class="headerlink" title="ReplicationControllerï¼ˆrcï¼‰"></a>ReplicationControllerï¼ˆrcï¼‰</h2><p>â€‹        rcæ˜¯ä¸€ç§Kubenetesèµ„æºï¼Œå¯ç¡®ä¿å®ƒçš„podå§‹ç»ˆä¿æŒè¿è¡ŒçŠ¶æ€ã€‚rcä¼šæŒç»­ç›‘æ§æ­£åœ¨è¿è¡Œçš„podåˆ—è¡¨ï¼Œ å¹¶ä¿è¯ç›¸åº”çš„podçš„æ•°ç›®ä¸æœŸæœ›ç›¸ç¬¦ã€‚</p>
<p>æ³¨ï¼šä¸Šé¢kubiaåˆ›å»ºä¾‹å­å°±æ˜¯rcçš„åº”ç”¨ã€‚</p>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211208165527010.png" alt="image-20211208165527010"></p>
<h3 id="åè°ƒæµç¨‹"><a href="#åè°ƒæµç¨‹" class="headerlink" title="åè°ƒæµç¨‹"></a>åè°ƒæµç¨‹</h3><p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211208170753086.png" alt="åè°ƒæµç¨‹"></p>
<h3 id="ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†"><a href="#ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†" class="headerlink" title="ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†"></a>ä¸‰ä¸ªä¸»è¦éƒ¨åˆ†</h3><ul>
<li>label selector ( æ ‡ç­¾é€‰æ‹©å™¨ï¼‰ï¼Œ ç”¨äºç¡®å®šrcä½œç”¨åŸŸä¸­æœ‰å“ªäº›pod</li>
<li>replica count (å‰¯æœ¬ä¸ªæ•°ï¼‰ï¼Œ æŒ‡å®šåº”è¿è¡Œçš„pod æ•°é‡ </li>
<li>pod template (podæ¨¡æ¿ï¼‰ï¼Œ ç”¨äºåˆ›å»ºæ–°çš„pod å‰¯æœ¬</li>
</ul>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211208171434826.png" alt="image-20211208171434826"></p>
<h3 id="rcä¸podå…³ç³»"><a href="#rcä¸podå…³ç³»" class="headerlink" title="rcä¸podå…³ç³»"></a>rcä¸podå…³ç³»</h3><p>â€‹        rcä¸podé€šè¿‡æ ‡ç­¾å…³è”ï¼Œå¯¹podåˆ é™¤æˆ–æ·»åŠ ç›¸å…³æ ‡ç­¾å¯ä»¥å°†podç§»å‡ºæˆ–ç§»å…¥rcçš„ä½œç”¨åŸŸã€‚</p>
<h3 id="ä¿®æ”¹rcä¸­podæ¨¡æ¿"><a href="#ä¿®æ”¹rcä¸­podæ¨¡æ¿" class="headerlink" title="ä¿®æ”¹rcä¸­podæ¨¡æ¿"></a>ä¿®æ”¹rcä¸­podæ¨¡æ¿</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl edit rc ã€rcNameã€‘</span><br><span class="line"><span class="comment"># è¿›å…¥é»˜è®¤æ–‡æœ¬ç¼–è¾‘å™¨ä¸­æ‰“å¼€ReplicationControllerçš„YAMLé…ç½®è¿›è¡Œç¼–è¾‘ï¼Œå¯¹ç°æœ‰çš„podæ²¡æœ‰å½±å“ã€‚</span></span><br></pre></td></tr></table></figure>

<h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥æ‰§è¡Œ</span></span><br><span class="line">kubectl scale rc ã€rcNameã€‘ --replicas=10</span><br><span class="line"><span class="comment"># ä¿®æ”¹yaml</span></span><br><span class="line">kubectl edit rc ã€rcNameã€‘<span class="comment">#è¿›å…¥ç¼–è¾‘ï¼Œä¿®æ”¹spec.replicaså€¼</span></span><br></pre></td></tr></table></figure>

<h3 id="åˆ é™¤rcä¿æŒpodè¿è¡Œ"><a href="#åˆ é™¤rcä¿æŒpodè¿è¡Œ" class="headerlink" title="åˆ é™¤rcä¿æŒpodè¿è¡Œ"></a>åˆ é™¤rcä¿æŒpodè¿è¡Œ</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl delete rc ã€rcNameã€‘ --cascade=<span class="literal">false</span></span><br><span class="line"><span class="comment"># åŸrcä½œç”¨åŸŸçš„podç‹¬ç«‹è¿è¡Œ</span></span><br></pre></td></tr></table></figure>

<h2 id="ReplicaSet-rs"><a href="#ReplicaSet-rs" class="headerlink" title="ReplicaSet(rs)"></a>ReplicaSet(rs)</h2><p>â€‹        <strong>ReplicaSet</strong> ï¼ˆæ–°ä¸€ä»£çš„rcï¼‰çš„è¡Œä¸ºä¸<strong>ReplicationController</strong> å®Œå…¨ç›¸åŒï¼Œ ä½†<strong>pod</strong> é€‰æ‹©å™¨çš„è¡¨è¾¾èƒ½åŠ›æ›´å¼ºã€‚ è™½ç„¶ <strong>ReplicationController</strong> çš„æ ‡ç­¾é€‰æ‹©å™¨åªå…è®¸åŒ…å«æŸä¸ªæ ‡ç­¾çš„åŒ¹é… <strong>pod,</strong> ä½†<strong>ReplicaSet</strong> çš„é€‰æ‹©å™¨è¿˜å…è®¸åŒ¹é…ç¼ºå°‘æŸä¸ªæ ‡ç­¾çš„ <strong>pod,</strong> æˆ–åŒ…å«ç‰¹å®šæ ‡ç­¾åçš„ <strong>pod,</strong> ä¸ç®¡å…¶å€¼å¦‚ä½•ã€‚</p>
<h3 id="ç¤ºä¾‹-2"><a href="#ç¤ºä¾‹-2" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/vlbeta2</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">	<span class="attr">name:</span> <span class="string">kubia</span> </span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">	<span class="attr">replicas:</span> <span class="number">3</span> </span><br><span class="line">	<span class="attr">selector:</span> </span><br><span class="line">		<span class="attr">matchLabels:</span> </span><br><span class="line">			<span class="attr">app:</span> <span class="string">kubia</span></span><br><span class="line">        <span class="comment">#matchExpressions: </span></span><br><span class="line">        <span class="comment">#    - key: app		#è¦æ±‚rsçš„podåŒ…å«æ ‡ç­¾åä¸ºappï¼Œæ ‡ç­¾å€¼å¿…é¡»ä¸ºkubia</span></span><br><span class="line">        <span class="comment">#      operator: In</span></span><br><span class="line">        <span class="comment">#      values:</span></span><br><span class="line">        <span class="comment">#      	- kubia</span></span><br><span class="line">	<span class="attr">template:</span> </span><br><span class="line">		<span class="attr">metadata:</span></span><br><span class="line">			<span class="attr">labels:</span> </span><br><span class="line">				<span class="attr">app:</span> <span class="string">kubia</span> </span><br><span class="line">		<span class="attr">spec:</span> </span><br><span class="line">			<span class="attr">containers:</span> </span><br><span class="line">			<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">kubia</span> </span><br><span class="line">			<span class="attr">image:</span> <span class="string">luksa/kubia</span></span><br></pre></td></tr></table></figure>

<blockquote>
<h3 id="operator-è¿ç®—ç¬¦ï¼‰"><a href="#operator-è¿ç®—ç¬¦ï¼‰" class="headerlink" title="operator (è¿ç®—ç¬¦ï¼‰"></a>operator (è¿ç®—ç¬¦ï¼‰</h3><ul>
<li>In : Labelçš„å€¼å¿…é¡»ä¸å…¶ä¸­ ä¸€ä¸ªæŒ‡å®šçš„values åŒ¹é…ã€‚</li>
<li>Notln : Labelçš„å€¼ä¸ä»»ä½•æŒ‡å®šçš„values ä¸åŒ¹é…ã€‚</li>
<li>Exists : pod å¿…é¡»åŒ…å«ä¸€ä¸ªæŒ‡å®šåç§°çš„æ ‡ç­¾ï¼ˆå€¼ä¸é‡è¦ï¼‰ã€‚ä½¿ç”¨æ­¤è¿ç®—ç¬¦æ—¶ï¼Œä¸åº”æŒ‡å®š valueså­—æ®µã€‚</li>
<li>DoesNotExist : podä¸å¾—åŒ…å«æœ‰æŒ‡å®šåç§°çš„æ ‡ç­¾ï¼Œvalueså±æ€§ä¸å¾—æŒ‡å®š ã€‚</li>
</ul>
<p>æ³¨ï¼šè‹¥æŒ‡å®šå¤šä¸ªè¡¨è¾¾å¼ï¼Œåˆ™éœ€è¦åŒæ—¶æˆç«‹</p>
</blockquote>
<h2 id="DaemonSetï¼ˆdsï¼‰"><a href="#DaemonSetï¼ˆdsï¼‰" class="headerlink" title="DaemonSetï¼ˆdsï¼‰"></a>DaemonSetï¼ˆdsï¼‰</h2><p><strong>ReplicationController</strong> å’Œ <strong>ReplicaSet</strong> å°† <strong>pod</strong> å®‰æ’åˆ°éšæœºé›†ç¾¤èŠ‚ç‚¹ï¼Œ è€Œ <strong>DaemonSet</strong>ç¡®ä¿æ¯ä¸ªèŠ‚ç‚¹éƒ½è¿è¡Œä¸€ä¸ª <strong>DaemonSet</strong> ä¸­å®šä¹‰çš„ <strong>pod</strong> å®ä¾‹ã€‚DaemonSet å¹¶æ²¡æœ‰æœŸæœ›çš„å‰¯æœ¬æ•°çš„æ¦‚å¿µã€‚å®ƒçš„å·¥ä½œæ˜¯ç¡®ä¿ä¸€ä¸ªpodåŒ¹é…å®ƒçš„é€‰æ‹©å™¨å¹¶åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œ ã€‚å¦‚æœ<strong>èŠ‚ç‚¹ä¸‹çº¿</strong>ï¼Œ DaemonSetä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹é‡æ–°åˆ›å»ºpodã€‚ ä½†æ˜¯ï¼Œ å½“å°† ä¸€ä¸ªæ–°èŠ‚ç‚¹æ·»åŠ åˆ°é›†ç¾¤ä¸­æ—¶ï¼Œ DaemonSetä¼šç«‹åˆ»éƒ¨ç½²ä¸€ä¸ªæ–°çš„podå®ä¾‹ ã€‚</p>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211208215133588.png" alt="image-20211208215133588"></p>
<h2 id="ServiceæœåŠ¡ï¼ˆSVCï¼‰"><a href="#ServiceæœåŠ¡ï¼ˆSVCï¼‰" class="headerlink" title="ServiceæœåŠ¡ï¼ˆSVCï¼‰"></a>ServiceæœåŠ¡ï¼ˆSVCï¼‰</h2><p><strong>Kubernetes</strong> æœåŠ¡æ˜¯ä¸€ç§ä¸ºä¸€ç»„åŠŸèƒ½ç›¸åŒçš„ <strong>pod</strong> æä¾›å•ä¸€<strong>ä¸å˜çš„æ¥å…¥ç‚¹</strong>çš„èµ„æºã€‚å½“æœåŠ¡å­˜åœ¨æ—¶ï¼Œå®ƒçš„ <strong>IP</strong> åœ°å€å’Œç«¯å£ä¸ä¼šæ”¹å˜ã€‚ å®¢æˆ·ç«¯é€šè¿‡ <strong>IP</strong> åœ°å€å’Œç«¯å£å·å»ºç«‹è¿æ¥ï¼Œè¿™äº›è¿æ¥ä¼šè¢«è·¯ç”±åˆ°æä¾›è¯¥æœåŠ¡çš„ä»»æ„ä¸€ä¸ª <strong>pod</strong> ä¸Šã€‚ä¸<code>rc</code>ä¸€æ ·é€šè¿‡æ ‡ç­¾é€‰æ‹©å™¨å†³å®šå“ªäº›podå±äºæœåŠ¡ã€‚</p>
<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211209141919554.png" alt="image-20211209141919554"></p>
<h3 id="ç¤ºä¾‹-3"><a href="#ç¤ºä¾‹-3" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#å¯ç›´æ¥ä½¿ç”¨kubectl exposeåˆ›å»ºï¼Œæˆ–é€šè¿‡å¦‚ä¸‹yamlé…ç½®æ–‡ä»¶ä¼ é€’åˆ°Kubernetes APIæœåŠ¡å™¨æ¥æ‰‹åŠ¨åˆ›å»ºæœåŠ¡</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">vl</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">kubia</span> </span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">	<span class="attr">sessionAffinity:</span> <span class="string">ClientIP</span> <span class="comment">#åŒä¸€ä¸ªå®¢æˆ·ç«¯äº§ç”Ÿçš„æ‰€æœ‰è¯·æ±‚æ¯æ¬¡éƒ½æŒ‡å‘åŒä¸€ä¸ªpodï¼Œé»˜è®¤ä¸ºNone</span></span><br><span class="line">	<span class="attr">portS:</span></span><br><span class="line">		<span class="bullet">-</span> <span class="attr">name:</span> <span class="string">http</span>		<span class="comment">#ç«¯å£åï¼ˆåœ¨éœ€è¦æš´éœ²å¤šä¸ªç«¯å£æ—¶å¿…é¡»æŒ‡å®šï¼‰</span></span><br><span class="line">		  <span class="attr">port:</span> <span class="number">80</span>			<span class="comment">#æœåŠ¡å¯ç”¨ç«¯å£</span></span><br><span class="line">		  <span class="attr">targetPort:</span> <span class="number">8080</span>  <span class="comment">#æœåŠ¡å°†è¿æ¥è½¬å‘åˆ°å®¹å™¨çš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥å¡«å¯¹åº”ç«¯å£å</span></span><br><span class="line">	<span class="attr">selector:</span> </span><br><span class="line">		<span class="attr">app:</span> <span class="string">kubia</span> 		<span class="comment">#å…·æœ‰app=kubiaæ ‡ç­¾çš„podå±äºè¯¥æœåŠ¡</span></span><br></pre></td></tr></table></figure>

<h3 id="é€šè¿‡-FQDN-è¿æ¥æœåŠ¡"><a href="#é€šè¿‡-FQDN-è¿æ¥æœåŠ¡" class="headerlink" title="é€šè¿‡ FQDN è¿æ¥æœåŠ¡"></a>é€šè¿‡ FQDN è¿æ¥æœåŠ¡</h3><p>â€‹        æ¯ä¸ªæœåŠ¡ä»å†…éƒ¨ DNS æœåŠ¡å™¨ä¸­è·å¾—DNSæ¡ç›®(pod æ˜¯å¦ä½¿ç”¨ éƒ¨çš„ DNS æœåŠ¡å™¨æ˜¯æ ¹æ® podä¸­specçš„dnsPolicy å±æ€§æ¥å†³å®šçš„)ï¼Œå®¢æˆ·ç«¯ pod åœ¨çŸ¥é“æœåŠ¡åç§°çš„æƒ…å†µä¸‹å¯ä»¥é€šè¿‡å…¨é™å®šåŸŸå (FQDN )æ¥è®¿é—®</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">serviceName.default.svc.cluster.local </span><br><span class="line"><span class="comment"># serviceNameå¯¹åº”äºæœåŠ¡åç§°ï¼Œ default è¡¨ç¤ºæœåŠ¡åœ¨å…¶ä¸­å®šä¹‰çš„å‘½åç©ºé—´ï¼Œè€Œ svc.cluster.local æ˜¯åœ¨æ‰€æœ‰é›†ç¾¤æœ¬åœ°æœåŠ¡åç§°ä¸­ä½¿ç”¨çš„å¯é…ç½®é›†ç¾¤åŸŸåç¼€ã€‚</span></span><br><span class="line"><span class="comment">#æ ¹æ®æ¯ä¸ªpodå®¹å™¨DNSè§£æå™¨é…ç½®çš„æ–¹å¼ï¼Œå¯ä»¥å°†å‘½åç©ºé—´å’Œsvc.cluster.localåç¼€çœç•¥æ‰.</span></span><br></pre></td></tr></table></figure>

<h3 id="è®¿é—®å¤–éƒ¨æœåŠ¡"><a href="#è®¿é—®å¤–éƒ¨æœåŠ¡" class="headerlink" title="è®¿é—®å¤–éƒ¨æœåŠ¡"></a>è®¿é—®å¤–éƒ¨æœåŠ¡</h3><p>æœåŠ¡ä¸ä»…å¯ä»¥å°†è¿æ¥é‡å®šå‘åˆ°é›†ç¾¤ä¸­çš„podï¼Œä¹Ÿå¯ä»¥é‡å®šå‘åˆ°å¤–éƒ¨ IP å’Œç«¯å£ã€‚åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„å®¢æˆ·ç«¯podå¯ä»¥åƒè¿æ¥åˆ°å†…éƒ¨æœåŠ¡é‚£æ ·è¿æ¥åˆ°å¤–éƒ¨æœåŠ¡</p>
<blockquote>
<p><strong>æœåŠ¡endpoint</strong></p>
<p>æœåŠ¡å¹¶ä¸æ˜¯å’Œ <strong>pod</strong> ç›´æ¥ç›¸è¿çš„ã€‚ä¸¤è€…ä¹‹é—´è¿˜æœ‰<strong>Endpoint</strong> èµ„æºï¼Œå¯æ‰§è¡Œ<code>kubectl describe</code>æŸ¥çœ‹ã€‚<strong>Endpoint</strong> èµ„æºå°±æ˜¯æš´éœ²ä¸€ä¸ªæœåŠ¡çš„ <strong>IP</strong> åœ°å€å’Œç«¯å£çš„åˆ—è¡¨ã€‚å°½ç®¡æœåŠ¡åœ¨ <strong>spec</strong> æœåŠ¡ä¸­å®šä¹‰äº† <strong>pod</strong>é€‰æ‹©å™¨ï¼Œä½†åœ¨é‡å®šå‘ä¼ å…¥è¿æ¥æ—¶ä¸ä¼šç›´æ¥ä½¿ç”¨å®ƒã€‚é€‰æ‹©å™¨ç”¨äºæ„å»º <strong>IP</strong> å’Œç«¯å£åˆ—è¡¨ï¼Œç„¶åå­˜å‚¨åœ¨ <strong>Endpoint</strong> èµ„æºä¸­ã€‚å½“å®¢æˆ·ç«¯è¿æ¥åˆ°æœåŠ¡æ—¶ï¼ŒæœåŠ¡ä»£ç†é€‰æ‹©è¿™äº› <strong>IP</strong> å’Œç«¯å£å¯¹ä¸­çš„ä¸€ä¸ªï¼Œå¹¶å°†ä¼ å…¥è¿æ¥é‡å®šå‘åˆ°åœ¨è¯¥ä½ç½®ç›‘å¬çš„æœåŠ¡å™¨ã€‚</p>
</blockquote>
<h4 id="ç¤ºä¾‹-4"><a href="#ç¤ºä¾‹-4" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><p><strong>æœåŠ¡é…ç½®</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">vl</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">	<span class="attr">name:</span> <span class="string">external-service</span></span><br><span class="line"><span class="attr">spec:</span> 		<span class="comment">#æœåŠ¡ä¸­æ²¡æœ‰å®šä¹‰é€‰æ‹©å™¨</span></span><br><span class="line">	<span class="attr">ports:</span> </span><br><span class="line">	 <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p><strong>endpointé…ç½®</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">vl</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">EndpointS</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">	<span class="attr">name:</span> <span class="string">external-service</span> <span class="comment">#åç§°å¿…é¡»ä¸æœåŠ¡ååŒ¹é…</span></span><br><span class="line"><span class="attr">subsets:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">addresses:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">11.11</span><span class="number">.11</span><span class="number">.11</span> <span class="comment"># æœåŠ¡å°†è¿æ¥é‡å®šå‘åˆ°endpointçš„IPåœ°å€</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">ip:</span> <span class="number">22.22</span><span class="number">.22</span><span class="number">.22</span></span><br><span class="line">		<span class="attr">ports:</span></span><br><span class="line">			<span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span> <span class="comment">#endpointçš„ç›®æ ‡ç«¯å£</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211209164332171.png" alt="image-20211209164332171"></p>
<h4 id="å¤–éƒ¨æœåŠ¡åˆ›å»ºåˆ«å"><a href="#å¤–éƒ¨æœåŠ¡åˆ›å»ºåˆ«å" class="headerlink" title="å¤–éƒ¨æœåŠ¡åˆ›å»ºåˆ«å"></a>å¤–éƒ¨æœåŠ¡åˆ›å»ºåˆ«å</h4><p>é™¤äº†æ‰‹åŠ¨é…ç½®æœåŠ¡çš„Endpointæ¥ä»£æ›¿å…¬å¼€å¤–éƒ¨æœåŠ¡æ–¹æ³•ï¼Œæœ‰ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯é€šè¿‡å…¶å®Œå…¨é™å®šåŸŸå(FQDN)è®¿é—®å¤–éƒ¨æœåŠ¡ã€‚è¦åˆ›å»ºä¸€ä¸ªå…·æœ‰åˆ«åçš„å¤–éƒ¨æœåŠ¡çš„æœåŠ¡æ—¶ï¼Œè¦å°†åˆ›å»ºæœåŠ¡èµ„æºçš„ä¸€ä¸ªtypeå­—æ®µè®¾ç½®ä¸ºExternalNameã€‚</p>
<p><strong>æœåŠ¡é…ç½®</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">vl</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">	<span class="attr">name:</span> <span class="string">external-service</span> </span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">	<span class="attr">type:</span> <span class="string">ExternalName</span> </span><br><span class="line">	<span class="attr">externalName:</span> <span class="string">someapi.somecompany.com</span> <span class="comment">#å®é™…è°ƒç”¨çš„å¤–éƒ¨æœåŠ¡åŸŸå</span></span><br><span class="line">	<span class="attr">ports:</span> </span><br><span class="line">		<span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p>æœåŠ¡åˆ›å»ºå®Œæˆåï¼Œpodå¯ä»¥é€šè¿‡external-service.default.svc.cluster.localåŸŸåï¼ˆç”šè‡³æ˜¯external-service)è¿æ¥åˆ°å¤–éƒ¨æœåŠ¡ã€‚</p>
<h3 id="æš´éœ²æœåŠ¡"><a href="#æš´éœ²æœåŠ¡" class="headerlink" title="æš´éœ²æœåŠ¡"></a>æš´éœ²æœåŠ¡</h3><h4 id="ä¸‰ç§æ–¹å¼"><a href="#ä¸‰ç§æ–¹å¼" class="headerlink" title="ä¸‰ç§æ–¹å¼"></a>ä¸‰ç§æ–¹å¼</h4><ul>
<li>å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆNodePortï¼šæ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹éƒ½ä¼šåœ¨<strong>èŠ‚ç‚¹</strong>ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œå¯¹äºNodePortæœåŠ¡ï¼Œ æ¯ä¸ªé›†ç¾¤èŠ‚ç‚¹åœ¨èŠ‚ç‚¹æœ¬èº«ï¼ˆå› æ­¤å¾—åå«NodePort)ä¸Šæ‰“å¼€ä¸€ä¸ªç«¯å£ï¼Œå¹¶å°†åœ¨è¯¥ç«¯å£ä¸Šæ¥æ”¶åˆ°çš„æµé‡é‡å®šå‘åˆ°åŸºç¡€æœåŠ¡ã€‚è¯¥æœåŠ¡ä»…åœ¨å†…éƒ¨é›†ç¾¤ <strong>IP</strong> å’Œç«¯å£ä¸Šæ‰å¯è®¿é—´ï¼Œ ä½†ä¹Ÿå¯é€šè¿‡æ‰€æœ‰èŠ‚ç‚¹ä¸Šçš„ä¸“ç”¨ç«¯å£è®¿é—®ã€‚</li>
</ul>
<blockquote>
<p>NodePortæœåŠ¡å®šä¹‰</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">vl</span> </span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span> </span><br><span class="line"><span class="attr">metadata:</span> </span><br><span class="line">	<span class="attr">name:</span> <span class="string">kubia-nodeport</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">	<span class="attr">type:</span> <span class="string">NodePort</span></span><br><span class="line">	<span class="attr">externalTrafficPorcy:</span> <span class="string">Local</span> <span class="comment"># éšæœºé€‰æ‹©çš„podåœ¨æ¥æ”¶è¿æ¥çš„åŒä¸€èŠ‚ç‚¹ä¸Šè¿è¡Œ.å¦‚æœæ²¡æœ‰æœ¬åœ°podå­˜åœ¨ï¼Œ åˆ™è¿æ¥å°†æŒ‚èµ·</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span> <span class="comment"># æœåŠ¡é›†ç¾¤çš„IPç«¯å£å·</span></span><br><span class="line">        <span class="attr">targetPort:</span> <span class="number">8080</span> <span class="comment"># åŸºç¡€æœåŠ¡podçš„ç›®æ ‡ç«¯å£</span></span><br><span class="line">        <span class="attr">nodePort:</span> <span class="number">30123</span> <span class="comment">#è®¿é—®é›†ç¾¤çš„ç«¯å£ï¼Œæ²¡æœ‰æŒ‡å®šä¼šéšæœºé€‰æ‹©ä¸€ä¸ªç«¯å£</span></span><br><span class="line">    <span class="attr">selector:</span> </span><br><span class="line">	    <span class="attr">app:</span> <span class="string">kubia</span></span><br></pre></td></tr></table></figure>
</blockquote>
<ul>
<li>å°†æœåŠ¡çš„ç±»å‹è®¾ç½®æˆLoadBalancerï¼šNodePortç±»å‹çš„ä¸€ ç§æ‰©å±•ï¼ŒæœåŠ¡å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸“ç”¨çš„è´Ÿè½½å‡è¡¡å™¨æ¥è®¿é—®ï¼Œ è¿™æ˜¯ç”±Kubernetesä¸­æ­£åœ¨è¿è¡Œçš„äº‘åŸºç¡€è®¾æ–½æä¾›çš„ã€‚ è´Ÿè½½å‡è¡¡å™¨å°†æµé‡é‡å®šå‘åˆ°è·¨æ‰€æœ‰èŠ‚ç‚¹çš„èŠ‚ç‚¹ç«¯å£ã€‚å®¢æˆ·ç«¯é€šè¿‡è´Ÿè½½å‡è¡¡å™¨çš„ <strong>IP</strong> è¿æ¥åˆ°æœåŠ¡ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªIngressèµ„æºæ§åˆ¶å™¨ï¼Œ è¿™æ˜¯ä¸€ä¸ªå®Œå…¨ä¸åŒçš„æœºåˆ¶ï¼Œé€šè¿‡ä¸€ ä¸ªIPåœ°å€å…¬å¼€å¤šä¸ªæœåŠ¡â€”â€”å®ƒè¿è¡Œåœ¨ <strong>HTTP</strong> å±‚ï¼ˆç½‘ç»œåè®®ç¬¬<strong>7</strong> å±‚ï¼‰ä¸Šï¼Œ å› æ­¤å¯ä»¥æä¾›æ¯”å·¥ä½œåœ¨ç¬¬4å±‚çš„æœåŠ¡æ›´å¤šçš„åŠŸèƒ½ã€‚<span style="color:red;"> æ¯ä¸ª <strong>LoadBalancer</strong> æœåŠ¡éƒ½éœ€è¦è‡ªå·±çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œ ä»¥åŠç‹¬æœ‰çš„å…¬æœ‰ <strong>IP</strong> åœ°å€ï¼Œ è€Œ <strong>Ingress</strong> åªéœ€è¦ä¸€ä¸ªå…¬ç½‘ <strong>IP</strong> å°±èƒ½ä¸ºè®¸å¤šæœåŠ¡æä¾›è®¿é—®ã€‚ å½“å®¢æˆ·ç«¯å‘ <strong>Ingress</strong> å‘é€ <strong>HTTP</strong> è¯·æ±‚æ—¶ï¼Œ <strong>Ingress</strong> ä¼šæ ¹æ®è¯·æ±‚çš„ä¸»æœºåå’Œè·¯å¾„å†³å®šè¯·æ±‚è½¬å‘åˆ°çš„æœåŠ¡ã€‚</span></li>
</ul>
<blockquote>
<p><strong>ç¤ºä¾‹</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/vlbetal</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span> </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">	<span class="attr">name :</span> <span class="string">kubia</span> </span><br><span class="line"><span class="attr">spec :</span> </span><br><span class="line">	<span class="attr">rules:</span> </span><br><span class="line">	<span class="bullet">-</span> <span class="attr">host:</span> <span class="string">kubia.example.com</span>  </span><br><span class="line">	  <span class="attr">http:</span> </span><br><span class="line">		<span class="attr">paths:</span></span><br><span class="line">		<span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">		  <span class="attr">backend:</span> <span class="comment"># å°†æ‰€æœ‰è¯·æ±‚ä¸»æœºkubia.example.comçš„httpè¯·æ±‚å‘é€åˆ°kubia-nodeportæœåŠ¡çš„80ç«¯å£</span></span><br><span class="line">			<span class="attr">serviceName:</span> <span class="string">kubia-nodeport</span></span><br><span class="line">			<span class="attr">servicePort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure>

<p><strong>åˆ—å‡ºæ‰€æœ‰Ingress</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get ingresses</span><br></pre></td></tr></table></figure>

<p><img src="/2021/12/05/%E9%83%A8%E7%BD%B2/Kubernetes%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20211209234539866.png" alt="image-20211209234539866"></p>
<p>æ³¨ï¼šå¯ä»¥è°ƒç”¨ kubectl apply - f Ã—Ã—.yaml ä¿®æ”¹æ–‡ä»¶ä¸­æŒ‡å®šçš„å†…å®¹æ¥æ›´æ–° Ingress èµ„æºï¼Œè€Œä¸æ˜¯é€šè¿‡åˆ é™¤å¹¶ä»æ–°æ–‡ä»¶é‡æ–°åˆ›å»ºçš„æ–¹å¼</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="https://kubernetes.io/zh/docs/tutorials/services/source-ip/">å®¢æˆ·ç«¯çœŸå®IPé—®é¢˜</a></p>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p>ã€ŠKubernetes in Action ä¸­æ–‡ç‰ˆã€‹â€”â€”<code>Marko Luksa</code></p>
<h2 id="END"><a href="#END" class="headerlink" title="END"></a>END</h2></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%83%A8%E7%BD%B2/">éƒ¨ç½²</a></div><div class="post_share"><div class="social-share" data-image="https://s1.ax1x.com/2020/09/17/wfnWJH.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/01/08/%E9%83%A8%E7%BD%B2/Git%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/"><img class="prev-cover" src="https://s1.ax1x.com/2020/09/17/wfnWJH.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Gitå¸¸ç”¨æŒ‡ä»¤</div></div></a></div><div class="next-post pull-right"><a href="/2021/11/19/GoLang/Go%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/"><img class="next-cover" src="https://s1.ax1x.com/2020/09/26/0igq0K.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">Goå†…å­˜ç®¡ç†</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2020/10/19/éƒ¨ç½²/æ‰“åŒ…vueé¡¹ç›®éƒ¨ç½²åˆ°nginx/" title="æ‰“åŒ…vueé¡¹ç›®éƒ¨ç½²åˆ°Nginx"><img class="cover" src="https://s1.ax1x.com/2020/09/17/wfuY6I.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-10-19</div><div class="title">æ‰“åŒ…vueé¡¹ç›®éƒ¨ç½²åˆ°Nginx</div></div></a></div><div><a href="/2021/02/07/éƒ¨ç½²/docker/" title="dockerå­¦ä¹ ç¬”è®°"><img class="cover" src="https://s1.ax1x.com/2020/09/17/wfu2n0.jpg"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-02-07</div><div class="title">dockerå­¦ä¹ ç¬”è®°</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></article></main><footer id="footer" style="background-image: url(https://s1.ax1x.com/2020/09/17/wfnWJH.jpg)" data-type="photo"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By CZM</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></section><div class="search-dialog" id="local-search"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>ç”±</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a>
 <span>æä¾›æ”¯æŒ</span></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="/js/search/local-search.js"></script><script>var endLoading = function () {
  document.body.style.overflow = 'auto';
  document.getElementById('loading-box').classList.add("loaded")
}
window.addEventListener('load',endLoading)</script><div class="js-pjax"><script>function loadValine () {
  function initValine () {
    window.valine = new Valine({
      el: '#vcomment',
      appId: 'k2GMUzIrob4GbB5vtonkzLSO-gzGzoHsz',
      appKey: '6k8wcGzpepgvksNzrQlYU2W1',
      placeholder: 'è®°å¾—ç•™ä¸‹ä½ çš„ç—•è¿¹â€¦â€¦',
      avatar: 'monsterid',
      meta: 'nick,mail,link'.split(','),
      pageSize: '10',
      lang: 'en',
      recordIP: false,
      serverURLs: '',
      emojiCDN: '',
      emojiMaps: "",
      enableQQ: false,
      path: window.location.pathname,
    });
    if ('nick,mail') { valine.config.requiredFields= 'nick,mail'.split(',') }
  }

  if (typeof Valine === 'function') initValine() 
  else $.getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js', initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.querySelector('#vcomment'),loadValine)
  else setTimeout(() => loadValine(), 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script defer="defer" id="ribbon_piao" mobile="false" src="/js/third-party/piao.js"></script><script src="/js/third-party/activate-power-mode.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
document.body.addEventListener('input', POWERMODE);
</script><script src="/js/third-party/click_heart.js" async="async"></script><script src="/js/third-party/ClickShowText.js" async="async"></script></div></body></html>